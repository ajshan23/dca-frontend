import{r as j,j as s,ar as k,as as H,at as L}from"./index-BUD-ZE7_.js";import{F as g,a as l}from"./Alert-lH7iap_A.js";import{B as P}from"./Button-DDszJLvt.js";import{F as v,c as F,a as C,b as o,d as x,h as M}from"./index.esm-N4d6fyIQ.js";import"./index-Ce7Q9rIH.js";import"./index-BnY8lDVe.js";import{t as d,N as m}from"./Upload-DwlahUs2.js";import"./Card-CdJ_W77y.js";import"./index-Cf80LcES.js";import"./Drawer-B4NC4z03.js";import"./index-yXOSGI-d.js";import{I as c}from"./hoist-non-react-statics.cjs-DWv9hK0a.js";import"./index-BanB7B1V.js";import"./ScrollBar-Ch0BYWof.js";import{A as S}from"./AdaptableCard-BRjN83AS.js";import"./Views-DlxN4gyE.js";import"./chart.config-D13uP9fv.js";import{Y as $,Z as R,_ as f,$ as b,T as V}from"./index-CGtXMN7D.js";import"./DataTable-BxgWjzyj.js";import"./SvgIcon-C1swRUoM.js";import{u as B}from"./useQuery-CXHXT3Hp.js";import"./toString-BowItcnA.js";import"./proxy-BY76j3GZ.js";import"./CloseButton-BxyE3bWT.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-CEViSscJ.js";import"./index-Chjiymov.js";import"./useThemeClass-U-zgIhiL.js";const D=F().shape({username:x().required("Username is required").min(3,"Username must be at least 3 characters").max(50,"Username must be less than 50 characters").matches(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers, and underscores")}),O=F().shape({currentPassword:x().required("Current password is required"),newPassword:x().required("New password is required").min(8,"Password must be at least 8 characters long"),confirmPassword:x().required("Please confirm your new password").oneOf([M("newPassword")],"Passwords do not match")}),bs=()=>{var N;const[p,U]=j.useState(!1),[h,q]=j.useState(!1),[u,z]=j.useState(!1),{data:w,isLoading:E,refetch:Z}=B({queryKey:["currentUser"],queryFn:()=>L()}),e=(N=w==null?void 0:w.data)==null?void 0:N.data,I=async(t,{setSubmitting:a})=>{var r,n;if(e){a(!0);try{(await k(e.id.toString(),{username:t.username})).data.success&&(d.push(s.jsx(m,{title:"Success",type:"success",children:"Username updated successfully"})),window.location.reload())}catch(i){d.push(s.jsx(m,{title:"Error",type:"danger",children:((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to update username"}))}finally{a(!1)}}},A=async(t,{setSubmitting:a,resetForm:r})=>{var n,i;a(!0);try{(await H(t)).data.success&&(d.push(s.jsx(m,{title:"Success",type:"success",children:"Password changed successfully"})),r())}catch(y){d.push(s.jsx(m,{title:"Error",type:"danger",children:((i=(n=y.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to change password"}))}finally{a(!1)}};return E?s.jsx("div",{className:"flex justify-center items-center h-40 text-sm",children:"Loading..."}):e?s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs(S,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b",children:[s.jsx("div",{className:"p-1.5 rounded-md bg-blue-50 text-blue-500",children:s.jsx($,{className:"text-base"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold",children:"Username"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Update your username"})]})]}),s.jsx(v,{initialValues:{username:(e==null?void 0:e.username)||""},enableReinitialize:!0,validationSchema:D,onSubmit:I,children:({touched:t,errors:a,isSubmitting:r,values:n})=>s.jsx(C,{children:s.jsxs(g,{children:[s.jsx(l,{label:"Username",invalid:!!a.username&&t.username,errorMessage:a.username,className:"mb-3",children:s.jsx(o,{type:"text",name:"username",placeholder:"Enter username",component:c,size:"sm"})}),s.jsxs("div",{className:"flex items-center justify-between mb-4 text-xs",children:[s.jsxs("div",{className:"text-gray-600",children:["Role: ",s.jsx("span",{className:"font-medium",children:e==null?void 0:e.role})]}),s.jsxs("div",{className:"text-gray-500",children:["Joined: ",new Date(e==null?void 0:e.createdAt).toLocaleDateString()]})]}),s.jsx(P,{variant:"solid",type:"submit",loading:r,disabled:n.username===(e==null?void 0:e.username)||r,className:"w-full py-1.5 text-sm",size:"sm",children:r?"Updating...":"Update Username"})]})})})]}),s.jsxs(S,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b",children:[s.jsx("div",{className:"p-1.5 rounded-md bg-amber-50 text-amber-500",children:s.jsx(R,{className:"text-base"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold",children:"Password"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Change your password"})]})]}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(v,{initialValues:{currentPassword:"",newPassword:"",confirmPassword:""},validationSchema:O,onSubmit:A,children:({touched:t,errors:a,isSubmitting:r})=>s.jsx(C,{children:s.jsxs(g,{children:[s.jsx(l,{label:"Current Password",invalid:!!a.currentPassword&&t.currentPassword,errorMessage:a.currentPassword,className:"mb-3",children:s.jsxs("div",{className:"relative",children:[s.jsx(o,{type:p?"text":"password",name:"currentPassword",placeholder:"Current password",component:c,className:"pr-8",size:"sm"}),s.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>U(!p),tabIndex:-1,children:p?s.jsx(f,{className:"h-4 w-4"}):s.jsx(b,{className:"h-4 w-4"})})]})}),s.jsx(l,{label:"New Password",invalid:!!a.newPassword&&t.newPassword,errorMessage:a.newPassword,className:"mb-3",children:s.jsxs("div",{className:"relative",children:[s.jsx(o,{type:h?"text":"password",name:"newPassword",placeholder:"New password",component:c,className:"pr-8",size:"sm"}),s.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>q(!h),tabIndex:-1,children:h?s.jsx(f,{className:"h-4 w-4"}):s.jsx(b,{className:"h-4 w-4"})})]})}),s.jsx(l,{label:"Confirm Password",invalid:!!a.confirmPassword&&t.confirmPassword,errorMessage:a.confirmPassword,className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(o,{type:u?"text":"password",name:"confirmPassword",placeholder:"Confirm password",component:c,className:"pr-8",size:"sm"}),s.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>z(!u),tabIndex:-1,children:u?s.jsx(f,{className:"h-4 w-4"}):s.jsx(b,{className:"h-4 w-4"})})]})}),s.jsx(P,{variant:"solid",type:"submit",loading:r,className:"w-full py-1.5 text-sm",size:"sm",children:r?"Changing...":"Change Password"})]})})}),s.jsxs("div",{className:"bg-blue-50 p-3 rounded-md border border-blue-200",children:[s.jsxs("h4",{className:"font-medium text-blue-700 mb-2 flex items-center gap-1.5 text-sm",children:[s.jsx(V,{className:"h-4 w-4"}),"Password Requirements"]}),s.jsxs("ul",{className:"space-y-1 text-xs text-blue-600",children:[s.jsxs("li",{className:"flex items-start gap-1.5",children:[s.jsx("span",{className:"text-blue-500 mt-0.5",children:"•"}),"At least 8 characters"]}),s.jsxs("li",{className:"flex items-start gap-1.5",children:[s.jsx("span",{className:"text-blue-500 mt-0.5",children:"•"}),"Different from current"]}),s.jsxs("li",{className:"flex items-start gap-1.5",children:[s.jsx("span",{className:"text-blue-500 mt-0.5",children:"•"}),"Letters, numbers, symbols"]}),s.jsxs("li",{className:"flex items-start gap-1.5",children:[s.jsx("span",{className:"text-blue-500 mt-0.5",children:"•"}),"Avoid common words"]})]})]})]})]})]}):s.jsx("div",{className:"p-4 text-center text-red-500 text-sm",children:"Failed to load user data"})};export{bs as default};
