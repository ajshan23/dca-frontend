import{r as u,h as R,j as e,J as W}from"./index-CRLhe4UJ.js";import{C as r}from"./Card-C9ZImza0.js";import{a as V,b as H,c as K,d as Q,A as Y,C as j}from"./chart.config-BGCa2kC1.js";import{B as m}from"./Button-8wmeFP59.js";import{u as w}from"./useQuery-x5c111Hj.js";import{a as _,b as U,c as X}from"./ProductService-DuAS4pFV.js";import{t as $,u as Z,v as ee}from"./index-IkMseqAw.js";import{B as se,a as te}from"./index-lN26XFhy.js";import{M as ae,a as re}from"./index-B19ZLQ2T.js";import{C as le}from"./ClipLoader-yxd9voJa.js";import"./index-Chjiymov.js";const F=["line","bar","area"],G=c=>{const{series:o=[],width:N="100%",height:x=300,xAxis:v,customOptions:y,type:a="line",direction:p,donutTitle:n,donutText:f,className:t,...b}=c,l=u.useRef(null),k=u.useMemo(()=>{switch(a){case"line":return V;case"bar":return Q;case"area":return K;case"donut":return H;default:return V}},[a]);let i=JSON.parse(JSON.stringify(k));const h=window.innerWidth<768,g=u.useCallback(()=>{if(l.current){const d=l.current.querySelectorAll("div.apexcharts-legend")[0];p===R&&(d.style.right="auto",d.style.left="0"),h&&(d.style.position="relative",d.style.top="0",d.style.justifyContent="start",d.style.padding="0")}},[p,h]);return u.useEffect(()=>{F.includes(a)&&g()},[a,g]),F.includes(a)&&(i.xaxis.categories=v),y&&(i={...i,...y}),a==="donut"&&(n&&(i.plotOptions.pie.donut.labels.total.label=n),f&&(i.plotOptions.pie.donut.labels.total.formatter=()=>f)),e.jsx("div",{ref:l,style:p===R?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(Y,{options:i,type:a,series:o,width:N,height:x,className:t,...b})})},ye=()=>{var d,C,S,A,O,B,L,D,I,M,P,T,E;const c=W(),[o,N]=u.useState(null);u.useEffect(()=>{const s=localStorage.getItem("user");if(s)try{N(JSON.parse(s))}catch(q){console.error("Error parsing user data:",q)}},[]);const{data:x,isLoading:v,error:y}=w({queryKey:["stock-summary"],queryFn:_}),{data:a,isLoading:p}=w({queryKey:["recent-assignments"],queryFn:()=>U({page:1,limit:5})}),{data:n,isLoading:f}=w({queryKey:["assignment-analytics"],queryFn:()=>X()}),t=((d=x==null?void 0:x.data)==null?void 0:d.data)||(x==null?void 0:x.data),b=((S=(C=a==null?void 0:a.data)==null?void 0:C.data)==null?void 0:S.data)||((A=a==null?void 0:a.data)==null?void 0:A.data)||[],l=((O=n==null?void 0:n.data)==null?void 0:O.data)||(n==null?void 0:n.data),k=v||p||f,i={data:Object.values((t==null?void 0:t.stockByStatus)||{}),labels:Object.keys((t==null?void 0:t.stockByStatus)||{})},h={data:((B=t==null?void 0:t.stockByCategory)==null?void 0:B.map(s=>s.availableStock))||[],labels:((L=t==null?void 0:t.stockByCategory)==null?void 0:L.map(s=>s.categoryName))||[]},g=b.filter(s=>s.isOverdue);return k?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(le,{color:"#3b82f6",size:50,speedMultiplier:.8})}):y?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsxs("p",{className:"text-red-500",children:["Failed to load dashboard data: ",y.message]})}):t?e.jsxs("div",{className:"flex flex-col gap-6 h-full p-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",children:["Welcome back, ",(o==null?void 0:o.name)||(o==null?void 0:o.username)||"User","!"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["You're managing ",t.totalProducts||0," products across ",((D=t.stockByCategory)==null?void 0:D.length)||0," categories"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalProducts||0})]}),e.jsx(se,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Available Stock"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((I=t.stockByStatus)==null?void 0:I.AVAILABLE)||0})]}),e.jsx(ae,{className:"h-8 w-8 text-green-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((M=t.stockByCategory)==null?void 0:M.length)||0})]}),e.jsx(te,{className:"h-8 w-8 text-purple-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Assignments"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(l==null?void 0:l.activeAssignments)||0})]}),e.jsx(re,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.lowStockCount||0})]}),e.jsx($,{className:"h-8 w-8 text-orange-500"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Stock by Category"}),e.jsx(m,{size:"xs",onClick:()=>c("/categories"),children:"View Categories"})]}),h.data.length>0?e.jsx(G,{series:h.data,xAxis:h.labels,height:300,type:"donut",customOptions:{colors:j,legend:{show:!0,position:"bottom"},dataLabels:{enabled:!0},plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"Total Stock",formatter:()=>`${t.totalInventory} items`}}}}}}}):e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"No category data available"})]}),e.jsxs(r,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Inventory Status"})}),i.data.length>0?e.jsx(G,{series:i.data,xAxis:i.labels,height:300,type:"bar",customOptions:{colors:[j[0],j[1],j[2],j[3],j[4]],legend:{show:!1},plotOptions:{bar:{distributed:!0,borderRadius:4,columnWidth:"60%"}}}}):e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"No inventory data available"})]}),e.jsxs(r,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Alerts & Status"}),e.jsxs("div",{className:"space-y-4",children:[(t.lowStockCount||0)>0&&e.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:"Low Stock Warning"})]}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:[t.lowStockCount," products are below minimum stock level"]}),e.jsx(m,{size:"xs",className:"mt-2",onClick:()=>c("/products?stockStatus=low"),children:"View Products"})]}),g.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Overdue Returns"})]}),e.jsxs("p",{className:"text-xs text-red-700 dark:text-red-400",children:[g.length," assignments are overdue"]}),e.jsx(m,{size:"xs",className:"mt-2",onClick:()=>c("/assignments?overdue=true"),children:"View Assignments"})]}),(t.lowStockCount||0)===0&&g.length===0&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"All Systems Normal"})]}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400",children:"No immediate attention required"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Categories:"}),e.jsx("span",{className:"font-medium",children:((P=t.stockByCategory)==null?void 0:P.length)||0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Return Rate:"}),e.jsxs("span",{className:"font-medium",children:[(l==null?void 0:l.returnRate)||"0","%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Damaged Items:"}),e.jsx("span",{className:"font-medium",children:((T=t.stockByStatus)==null?void 0:T.DAMAGED)||0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"In Maintenance:"}),e.jsx("span",{className:"font-medium",children:((E=t.stockByStatus)==null?void 0:E.MAINTENANCE)||0})]})]})]})]})]}),(t==null?void 0:t.stockByCategory)&&t.stockByCategory.length>0&&e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Category-wise Stock Summary"}),e.jsx(m,{size:"xs",onClick:()=>c("/categories"),children:"Manage Categories"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2",children:"Category"}),e.jsx("th",{className:"text-center py-2",children:"Products"}),e.jsx("th",{className:"text-center py-2",children:"Available Stock"})]})}),e.jsx("tbody",{children:t.stockByCategory.map((s,q)=>{var z;return t.totalInventory>0&&Math.round(s.availableStock/t.totalInventory*100),(z=t.lowStockProducts)!=null&&z.filter(J=>J.category===s.categoryName).length,e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"py-3 font-medium",children:s.categoryName}),e.jsx("td",{className:"py-3 text-center",children:s.productCount}),e.jsx("td",{className:"py-3 text-center",children:s.availableStock})]},s.categoryId)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Assignments"}),e.jsx(m,{size:"xs",onClick:()=>c("/assignments"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent assignments"}):b.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["To: ",s.employee.name," (",s.employee.empId,")"]}),e.jsxs("p",{children:["Category: ",s.product.category.name]}),e.jsxs("p",{children:["Item: ",s.inventory.serialNumber||`#${s.inventory.id}`]}),e.jsx("p",{children:new Date(s.assignedAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.isOverdue?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.isOverdue?`Overdue (${s.daysOverdue}d)`:"Active"})]},s.id))})]}),e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Stock Activity"}),e.jsx(m,{size:"xs",onClick:()=>c("/products/transactions/history"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:!t.recentTransactions||t.recentTransactions.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent transactions"}):t.recentTransactions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.inventory.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Category: ",s.inventory.product.category]}),e.jsx("p",{children:s.reason}),e.jsxs("p",{children:["By: ",s.performedBy||"System"]}),e.jsx("p",{children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.type==="IN"?"bg-green-100 text-green-800":s.type==="OUT"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.type})]},s.id))})]})]}),t.lowStockProducts&&t.lowStockProducts.length>0&&e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Products Requiring Attention"}),e.jsx(m,{size:"xs",onClick:()=>c("/products?stockStatus=low"),children:"Manage Stock"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2",children:"Product"}),e.jsx("th",{className:"text-left py-2",children:"Model"}),e.jsx("th",{className:"text-left py-2",children:"Category"}),e.jsx("th",{className:"text-center py-2",children:"Current Stock"}),e.jsx("th",{className:"text-center py-2",children:"Min Required"}),e.jsx("th",{className:"text-center py-2",children:"Status"})]})}),e.jsx("tbody",{children:t.lowStockProducts.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"py-3 font-medium",children:s.name}),e.jsx("td",{className:"py-3",children:s.model}),e.jsx("td",{className:"py-3",children:s.category}),e.jsx("td",{className:"py-3 text-center",children:s.currentStock}),e.jsx("td",{className:"py-3 text-center",children:s.minStock}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.currentStock===0?"bg-red-100 text-red-800":"bg-orange-100 text-orange-800"}`,children:s.currentStock===0?"Out of Stock":"Low Stock"})})]},s.id))})]})})]})]}):e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"No dashboard data available"})})};export{ye as default};
