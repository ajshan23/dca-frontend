import{M as pe,J as ve,r as u,j as e}from"./index-rIFH6k4g.js";import{u as je}from"./useQuery-Cvu5mUxz.js";import{u as f}from"./useMutation-D6VJ0PHv.js";import{f as be,j as ye,k as Ne,l as fe,m as we}from"./ProductService-FAH52uD-.js";import"./Alert-BXvaanNu.js";import"./index-D1zb3KDM.js";import{S as G}from"./index-B_X9YUzt.js";import{B as o}from"./Button-BLsb7UDu.js";import{t as l,N as c,D as B}from"./Upload-ilZw4A4N.js";import{C as w}from"./Card-CATgrbVU.js";import"./index-CwOsvrDI.js";import"./Drawer-BSW7APxh.js";import"./index-CXy5gsdO.js";import{I as h}from"./hoist-non-react-statics.cjs-Dh4Amu6n.js";import"./index-R-HYP-jI.js";import"./ScrollBar-Uobvb02Y.js";import{D as T}from"./DataTable-DH1c_1Gx.js";import{D as Se,z as U,E as H,w as Ce,F as Ae}from"./index-Ctcp45-r.js";import{M as De,a as ke}from"./index-CxRfxmhG.js";import{B as z}from"./index-C5aqVFO3.js";import{C as Ee}from"./ClipLoader-BMHuHHXE.js";import"./toString-DUfzYozp.js";import"./proxy-Dq6k2qqt.js";import"./Views-N-kQq2tB.js";import"./CloseButton-DwbG0elL.js";import"./_getPrototype-BHi8KFZ3.js";import"./index-Chjiymov.js";const Ie={AVAILABLE:"text-green-600 bg-transparent  w-fit",ASSIGNED:"text-blue-600 bg-transparent  w-fit",MAINTENANCE:"text-yellow-600 bg-transparent  w-fit",DAMAGED:"text-red-600 bg-transparent  w-fit",RETIRED:"text-gray-600 bg-transparent  w-fit"},W={NEW:"text-green-600 bg-transparent  w-fit",GOOD:"text-blue-600 bg-transparent  w-fit",FAIR:"text-yellow-600 bg-transparent  w-fit",POOR:"text-orange-600 bg-transparent  w-fit",DAMAGED:"text-red-600 bg-transparent  w-fit"},Pe={ASSIGNED:"text-blue-600 bg-transparent   w-fit",RETURNED:"text-emerald-600 bg-transparent   w-fit",OVERDUE:"text-red-600 bg-transparent  w-fit"},ot=()=>{var A,D,k,E,I,P,R,L,O,Q,M;const{id:p}=pe(),V=ve(),[_,x]=u.useState(!1),[Y,v]=u.useState(!1),[i,d]=u.useState(null),[r,j]=u.useState({quantity:1,serialNumbers:[""],purchasePrice:"",location:""}),[g,b]=u.useState(""),{data:m,isLoading:J,error:S,refetch:C}=je({queryKey:["product",p],queryFn:()=>fe(Number(p)),enabled:!!p}),{mutate:Re,isPending:Le}=f({mutationFn:async t=>{const s=await we(t);if(!(s!=null&&s.qrCode))throw new Error("Invalid QR code data received from server");return s.qrCode},onSuccess:t=>{ae(t)},onError:t=>{l.push(e.jsx(c,{title:"Error",type:"danger",children:t.message||"Failed to generate QR code"}))}}),{mutate:K,isPending:X}=f({mutationFn:async t=>{var n;const s=await Ne(t);if(!((n=s.data)!=null&&n.qrCode))throw new Error("Invalid QR code data received from server");return{qrCode:s.data.qrCode,assignmentInfo:s.data.assignmentInfo}},onSuccess:t=>{ne(t.qrCode,t.assignmentInfo)},onError:t=>{l.push(e.jsx(c,{title:"Error",type:"danger",children:t.message||"Failed to generate assignment QR code"}))}}),{mutate:Z,isPending:ee}=f({mutationFn:t=>be(Number(p),t),onSuccess:t=>{var s;l.push(e.jsx(c,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Stock added successfully"})),C(),x(!1),ie()},onError:t=>{var s,n;l.push(e.jsx(c,{title:"Error",type:"danger",children:((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to add stock"}))}}),{mutate:te,isPending:se}=f({mutationFn:t=>ye(t.inventoryId,t.updateData),onSuccess:t=>{var s;l.push(e.jsx(c,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Inventory updated successfully"})),C(),v(!1),d(null)},onError:t=>{var s,n;l.push(e.jsx(c,{title:"Error",type:"danger",children:((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to update inventory"}))}}),ae=t=>{const s=window.open("","_blank","width=600,height=600");s&&a&&(s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Product QR Code - ${a.name}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .product-info {
                margin-bottom: 20px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>${a.name} QR Code</h2>
            <div class="product-info">
              <p><strong>Model:</strong> ${a.model}</p>
              <p><strong>ID:</strong> ${a.id}</p>
            </div>
            <div class="qr-container">
              <img src="${t}" alt="QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),s.document.close())},ne=(t,s)=>{const n=window.open("","_blank","width=600,height=700");n&&a&&(n.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Assignment QR Code - ${s.productName}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .assignment-info {
                margin-bottom: 20px;
                text-align: left;
              }
              .info-row {
                margin-bottom: 8px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>Assignment QR Code</h2>
            <div class="assignment-info">
              <div class="info-row"><strong>Product:</strong> ${s.productName}</div>
              <div class="info-row"><strong>Assigned To:</strong> ${s.employeeName}</div>
              <div class="info-row"><strong>Assigned On:</strong> ${new Date(s.assignedAt).toLocaleDateString()}</div>
              <div class="info-row"><strong>Status:</strong> ${s.status}</div>
              ${s.expectedReturnAt?`<div class="info-row"><strong>Expected Return:</strong> ${new Date(s.expectedReturnAt).toLocaleDateString()}</div>`:""}
            </div>
            <div class="qr-container">
              <img src="${t}" alt="Assignment QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),n.document.close())},ie=()=>{j({quantity:1,serialNumbers:[""],purchasePrice:"",location:""})},re=()=>{const t={quantity:r.quantity,serialNumbers:r.serialNumbers.filter(s=>s.trim()),purchasePrice:r.purchasePrice?Number(r.purchasePrice):void 0,location:r.location.trim()||void 0,reason:"Manual stock addition"};Z(t)},oe=t=>{d(t),v(!0)},le=()=>{i&&te({inventoryId:i.id,updateData:{status:i.status,condition:i.condition,location:i.location,notes:i.notes,serialNumber:i.serialNumber,reason:"Manual inventory update"}})},a=((A=m==null?void 0:m.data)==null?void 0:A.data)||(m==null?void 0:m.data),y=u.useMemo(()=>{if(!(a!=null&&a.inventory)||!g.trim())return(a==null?void 0:a.inventory)||[];const t=g.toLowerCase().trim();return a.inventory.filter(s=>{var q,F,$;const n=((q=s.serialNumber)==null?void 0:q.toLowerCase())||"",N=`item #${s.id}`.toLowerCase(),me=s.status.toLowerCase(),ue=s.condition.toLowerCase(),he=((F=s.location)==null?void 0:F.toLowerCase())||"",xe=(($=s.notes)==null?void 0:$.toLowerCase())||"",ge=s.purchaseDate?new Date(s.purchaseDate).toLocaleDateString().toLowerCase():"";return n.includes(t)||N.includes(t)||me.includes(t)||ue.includes(t)||he.includes(t)||xe.includes(t)||ge.includes(t)})},[a==null?void 0:a.inventory,g]),ce=[{header:"Serial Number",cell:t=>t.row.original.serialNumber||`Item #${t.row.original.id}`},{header:"Status",cell:t=>e.jsx("div",{className:Ie[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Condition",cell:t=>e.jsx("div",{className:W[t.row.original.condition]||"bg-gray-500 text-white",children:t.row.original.condition})},{header:"Purchase Date",cell:t=>t.row.original.purchaseDate?new Date(t.row.original.purchaseDate).toLocaleDateString():"-"},{header:"Actions",cell:t=>e.jsx(o,{size:"xs",icon:e.jsx(Ce,{}),onClick:()=>oe(t.row.original),disabled:t.row.original.status==="ASSIGNED"})}],de=[{header:"Employee",cell:t=>{var s,n;return e.jsxs("span",{children:[((s=t.row.original.employee)==null?void 0:s.name)||"Unknown",((n=t.row.original.employee)==null?void 0:n.empId)&&` (${t.row.original.employee.empId})`]})}},{header:"Inventory Item",cell:t=>{var s,n;return e.jsx("span",{children:((s=t.row.original.inventory)==null?void 0:s.serialNumber)||`Item #${((n=t.row.original.inventory)==null?void 0:n.id)||"N/A"}`})}},{header:"Assigned On",cell:t=>new Date(t.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:t=>t.row.original.expectedReturnAt?new Date(t.row.original.expectedReturnAt).toLocaleDateString():"-"},{header:"Returned On",cell:t=>t.row.original.returnedAt?new Date(t.row.original.returnedAt).toLocaleDateString():"-"},{header:"Status",cell:t=>e.jsx("div",{className:Pe[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Return Condition",cell:t=>t.row.original.returnCondition?e.jsx("div",{className:W[t.row.original.returnCondition]||"bg-gray-500 text-white",children:t.row.original.returnCondition}):e.jsx("span",{children:"-"})},{header:"Assigned By",cell:t=>{var s;return((s=t.row.original.assignedBy)==null?void 0:s.username)||"Unknown"}},{header:"Actions",cell:t=>e.jsx(o,{size:"xs",icon:e.jsx(Ae,{}),onClick:()=>K(t.row.original.id),loading:X,title:"Generate QR Code"})}];return S&&l.push(e.jsx(c,{title:"Error",type:"danger",children:S.message||"Failed to load product details"})),J?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ee,{color:"#3B82F6",size:40})}):a?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(o,{variant:"plain",icon:e.jsx(Se,{}),onClick:()=>V(-1),children:"Back to Products"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(o,{variant:"twoTone",icon:e.jsx(U,{}),onClick:()=>x(!0),children:"Add Stock"})})]}),e.jsx(w,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.model}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Category:"}),e.jsx("span",{className:"ml-2",children:((D=a.category)==null?void 0:D.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Branch:"}),e.jsx("span",{className:"ml-2",children:((k=a.branch)==null?void 0:k.name)||"-"})]}),a.department&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Department:"}),e.jsx("span",{className:"ml-2",children:a.department.name})]}),a.warrantyDuration&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Warranty Duration:"}),e.jsxs("span",{className:"ml-2",children:[a.warrantyDuration," months"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Minimum Stock Level:"}),e.jsx("span",{className:"ml-2",children:a.minStockLevel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(a.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx("div",{className:a.complianceStatus?"font-bold text-green-500":"font-bold text-red-500",children:a.complianceStatus?"Compliant":"Non-compliant"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Stock Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Stock:"}),e.jsx("span",{className:"ml-2 font-semibold",children:((E=a.stockStats)==null?void 0:E.totalStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Available:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-600",children:((I=a.stockStats)==null?void 0:I.availableStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assigned:"}),e.jsx("span",{className:"ml-2 font-semibold text-blue-600",children:((P=a.stockStats)==null?void 0:P.assignedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Damaged:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-600",children:((R=a.stockStats)==null?void 0:R.damagedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Maintenance:"}),e.jsx("span",{className:"ml-2 font-semibold text-yellow-600",children:((L=a.stockStats)==null?void 0:L.maintenanceStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Retired:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-600",children:((O=a.stockStats)==null?void 0:O.retiredStock)||0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:a.description||"No description available"})]})]})]})}),e.jsxs(w,{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Inventory Items"})]})}),e.jsx("div",{className:"mb-4 max-w-md",children:e.jsx(h,{placeholder:"Search inventory items...",value:g,onChange:t=>b(t.target.value),prefix:e.jsx(H,{className:"text-gray-400"}),clearButton:!0,onClear:()=>b("")})}),g.trim()&&e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Showing ",y.length," of ",((Q=a.inventory)==null?void 0:Q.length)||0," items",y.length!==(((M=a.inventory)==null?void 0:M.length)||0)&&e.jsx(o,{variant:"plain",size:"xs",className:"ml-2",onClick:()=>b(""),children:"Clear search"})]}),!a.inventory||a.inventory.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items found for this product"}),e.jsx(o,{className:"mt-4",variant:"solid",icon:e.jsx(U,{}),onClick:()=>x(!0),children:"Add First Stock"})]}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items match your search"}),e.jsx(o,{className:"mt-4",variant:"plain",onClick:()=>b(""),children:"Clear search"})]}):e.jsx(T,{columns:ce,data:y})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Assignment History"})]}),!a.assignments||a.assignments.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No assignments found for this product"})}):e.jsx(T,{columns:de,data:a.assignments})]}),e.jsxs(B,{isOpen:_,onClose:()=>x(!1),width:500,children:[e.jsxs("h4",{className:"mb-4",children:["Add Stock to ",a.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity"}),e.jsx(h,{type:"number",min:"1",max:"100",value:r.quantity,onChange:t=>j({...r,quantity:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Purchase Price per Item (Optional)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:r.purchasePrice,onChange:t=>j({...r,purchasePrice:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Serial Numbers (Optional - ",r.serialNumbers.length," of ",r.quantity,")"]}),Array.from({length:r.quantity},(t,s)=>e.jsx(h,{type:"text",placeholder:`Serial number ${s+1}`,value:r.serialNumbers[s]||"",onChange:n=>{const N=[...r.serialNumbers];N[s]=n.target.value,j({...r,serialNumbers:N})},className:"mb-2"},s))]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(o,{variant:"plain",onClick:()=>x(!1),children:"Cancel"}),e.jsx(o,{variant:"solid",onClick:re,loading:ee,icon:e.jsx(z,{}),children:"Add Stock"})]})]})]}),e.jsxs(B,{isOpen:Y,onClose:()=>v(!1),width:400,children:[e.jsx("h4",{className:"mb-4",children:"Edit Inventory Item"}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Serial Number"}),e.jsx(h,{type:"text",value:i.serialNumber||"",onChange:t=>d({...i,serialNumber:t.target.value||null}),placeholder:"Enter serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsx(G,{value:{value:i.status,label:i.status},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Maintenance"},{value:"DAMAGED",label:"Damaged"},{value:"RETIRED",label:"Retired"}],onChange:t=>d({...i,status:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx(G,{value:{value:i.condition,label:i.condition},options:[{value:"NEW",label:"New"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"},{value:"DAMAGED",label:"Damaged"}],onChange:t=>d({...i,condition:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx(h,{as:"textarea",value:i.notes||"",onChange:t=>d({...i,notes:t.target.value}),placeholder:"Additional notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(o,{variant:"plain",onClick:()=>v(!1),children:"Cancel"}),e.jsx(o,{variant:"solid",onClick:le,loading:se,children:"Update"})]})]})]})]}):e.jsx("div",{className:"p-4 text-center",children:"Product not found"})};export{ot as default};
