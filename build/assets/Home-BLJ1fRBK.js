import{r as u,h as $,j as e,J as K}from"./index-raIB5kr7.js";import{C as r}from"./Card-3F_r41t5.js";import{P as Q}from"./Progress-CjK2z3SZ.js";import{a as F,b as Y,c as _,d as U,A as X,C as n}from"./chart.config-DJqIkkyf.js";import{B as h}from"./Button-93EWxRqP.js";import{u as S}from"./useQuery-BimGM40F.js";import{a as Z,b as ee,c as se}from"./ProductService-BdWVaAcP.js";import{t as G,u as te,v as ae}from"./index-YT-1x9V6.js";import{B as re,a as le}from"./index-DRrr66wc.js";import{M as ce,a as ne}from"./index-DLWYlJg8.js";import{C as ie}from"./ClipLoader-DD4fPWNo.js";import"./index-Chjiymov.js";const H=["line","bar","area"],J=i=>{const{series:x=[],width:b="100%",height:m=300,xAxis:v,customOptions:p,type:a="line",direction:y,donutTitle:d,donutText:f,className:t,...N}=i,l=u.useRef(null),k=u.useMemo(()=>{switch(a){case"line":return F;case"bar":return U;case"area":return _;case"donut":return Y;default:return F}},[a]);let c=JSON.parse(JSON.stringify(k));const g=window.innerWidth<768,j=u.useCallback(()=>{if(l.current){const o=l.current.querySelectorAll("div.apexcharts-legend")[0];y===$&&(o.style.right="auto",o.style.left="0"),g&&(o.style.position="relative",o.style.top="0",o.style.justifyContent="start",o.style.padding="0")}},[y,g]);return u.useEffect(()=>{H.includes(a)&&j()},[a,j]),H.includes(a)&&(c.xaxis.categories=v),p&&(c={...c,...p}),a==="donut"&&(d&&(c.plotOptions.pie.donut.labels.total.label=d),f&&(c.plotOptions.pie.donut.labels.total.formatter=()=>f)),e.jsx("div",{ref:l,style:y===$?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(X,{options:c,type:a,series:x,width:b,height:m,className:t,...N})})},be=()=>{var o,A,O,B,L,D,I,P,M,T,E,q,z;const i=K(),[x,b]=u.useState(null);u.useEffect(()=>{const s=localStorage.getItem("user");if(s)try{b(JSON.parse(s))}catch(w){console.error("Error parsing user data:",w)}},[]);const{data:m,isLoading:v,error:p}=S({queryKey:["stock-summary"],queryFn:Z}),{data:a,isLoading:y}=S({queryKey:["recent-assignments"],queryFn:()=>ee({page:1,limit:5})}),{data:d,isLoading:f}=S({queryKey:["assignment-analytics"],queryFn:()=>se()}),t=((o=m==null?void 0:m.data)==null?void 0:o.data)||(m==null?void 0:m.data),N=((O=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:O.data)||((B=a==null?void 0:a.data)==null?void 0:B.data)||[],l=((L=d==null?void 0:d.data)==null?void 0:L.data)||(d==null?void 0:d.data),k=v||y||f,c={data:Object.values((t==null?void 0:t.stockByStatus)||{}),labels:Object.keys((t==null?void 0:t.stockByStatus)||{})},g={data:((D=t==null?void 0:t.stockByCategory)==null?void 0:D.map(s=>s.availableStock))||[],labels:((I=t==null?void 0:t.stockByCategory)==null?void 0:I.map(s=>s.categoryName))||[]},j=N.filter(s=>s.isOverdue);return k?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(ie,{color:"#3b82f6",size:50,speedMultiplier:.8})}):p?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsxs("p",{className:"text-red-500",children:["Failed to load dashboard data: ",p.message]})}):t?e.jsxs("div",{className:"flex flex-col gap-6 h-full p-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",children:["Welcome back, ",(x==null?void 0:x.name)||(x==null?void 0:x.username)||"User","!"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["You're managing ",t.totalProducts||0," products across ",((P=t.stockByCategory)==null?void 0:P.length)||0," categories"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalProducts||0})]}),e.jsx(re,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Available Stock"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((M=t.stockByStatus)==null?void 0:M.AVAILABLE)||0})]}),e.jsx(ce,{className:"h-8 w-8 text-green-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((T=t.stockByCategory)==null?void 0:T.length)||0})]}),e.jsx(le,{className:"h-8 w-8 text-purple-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Assignments"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(l==null?void 0:l.activeAssignments)||0})]}),e.jsx(ne,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.lowStockCount||0})]}),e.jsx(G,{className:"h-8 w-8 text-orange-500"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Stock by Category"}),e.jsx(h,{size:"xs",onClick:()=>i("/categories"),children:"View Categories"})]}),g.data.length>0?e.jsx(J,{series:g.data,xAxis:g.labels,height:300,type:"donut",customOptions:{colors:n,legend:{show:!0,position:"bottom"},dataLabels:{enabled:!0},plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"Total Stock",formatter:()=>`${t.totalInventory} items`}}}}}}}):e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"No category data available"})]}),e.jsxs(r,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Inventory Status"})}),c.data.length>0?e.jsx(J,{series:c.data,xAxis:c.labels,height:300,type:"bar",customOptions:{colors:[n[0],n[1],n[2],n[3],n[4]],legend:{show:!1},plotOptions:{bar:{distributed:!0,borderRadius:4,columnWidth:"60%"}}}}):e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"No inventory data available"})]}),e.jsxs(r,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Alerts & Status"}),e.jsxs("div",{className:"space-y-4",children:[(t.lowStockCount||0)>0&&e.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:"Low Stock Warning"})]}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:[t.lowStockCount," products are below minimum stock level"]}),e.jsx(h,{size:"xs",className:"mt-2",onClick:()=>i("/products?stockStatus=low"),children:"View Products"})]}),j.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Overdue Returns"})]}),e.jsxs("p",{className:"text-xs text-red-700 dark:text-red-400",children:[j.length," assignments are overdue"]}),e.jsx(h,{size:"xs",className:"mt-2",onClick:()=>i("/assignments?overdue=true"),children:"View Assignments"})]}),(t.lowStockCount||0)===0&&j.length===0&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"All Systems Normal"})]}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400",children:"No immediate attention required"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Categories:"}),e.jsx("span",{className:"font-medium",children:((E=t.stockByCategory)==null?void 0:E.length)||0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Return Rate:"}),e.jsxs("span",{className:"font-medium",children:[(l==null?void 0:l.returnRate)||"0","%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Damaged Items:"}),e.jsx("span",{className:"font-medium",children:((q=t.stockByStatus)==null?void 0:q.DAMAGED)||0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"In Maintenance:"}),e.jsx("span",{className:"font-medium",children:((z=t.stockByStatus)==null?void 0:z.MAINTENANCE)||0})]})]})]})]})]}),(t==null?void 0:t.stockByCategory)&&t.stockByCategory.length>0&&e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Category-wise Stock Summary"}),e.jsx(h,{size:"xs",onClick:()=>i("/categories"),children:"Manage Categories"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2",children:"Category"}),e.jsx("th",{className:"text-center py-2",children:"Products"}),e.jsx("th",{className:"text-center py-2",children:"Available Stock"}),e.jsx("th",{className:"text-center py-2",children:"Stock Percentage"}),e.jsx("th",{className:"text-center py-2",children:"Status"})]})}),e.jsx("tbody",{children:t.stockByCategory.map((s,w)=>{var V;const C=t.totalInventory>0?Math.round(s.availableStock/t.totalInventory*100):0,R=((V=t.lowStockProducts)==null?void 0:V.filter(W=>W.category===s.categoryName).length)||0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"py-3 font-medium",children:s.categoryName}),e.jsx("td",{className:"py-3 text-center",children:s.productCount}),e.jsx("td",{className:"py-3 text-center",children:s.availableStock}),e.jsx("td",{className:"py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Q,{percent:C,className:"w-20 mr-2",color:C>20?n[w%n.length]:n[n.length-1]}),e.jsxs("span",{children:[C,"%"]})]})}),e.jsx("td",{className:"py-3 text-center",children:R>0?e.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:[R," low stock"]}):e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Healthy"})})]},s.categoryId)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Assignments"}),e.jsx(h,{size:"xs",onClick:()=>i("/assignments"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent assignments"}):N.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["To: ",s.employee.name," (",s.employee.empId,")"]}),e.jsxs("p",{children:["Category: ",s.product.category.name]}),e.jsxs("p",{children:["Item: ",s.inventory.serialNumber||`#${s.inventory.id}`]}),e.jsx("p",{children:new Date(s.assignedAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.isOverdue?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.isOverdue?`Overdue (${s.daysOverdue}d)`:"Active"})]},s.id))})]}),e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Stock Activity"}),e.jsx(h,{size:"xs",onClick:()=>i("/products/transactions/history"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:!t.recentTransactions||t.recentTransactions.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent transactions"}):t.recentTransactions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.inventory.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Category: ",s.inventory.product.category]}),e.jsx("p",{children:s.reason}),e.jsxs("p",{children:["By: ",s.performedBy||"System"]}),e.jsx("p",{children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.type==="IN"?"bg-green-100 text-green-800":s.type==="OUT"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.type})]},s.id))})]})]}),t.lowStockProducts&&t.lowStockProducts.length>0&&e.jsxs(r,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Products Requiring Attention"}),e.jsx(h,{size:"xs",onClick:()=>i("/products?stockStatus=low"),children:"Manage Stock"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2",children:"Product"}),e.jsx("th",{className:"text-left py-2",children:"Model"}),e.jsx("th",{className:"text-left py-2",children:"Category"}),e.jsx("th",{className:"text-center py-2",children:"Current Stock"}),e.jsx("th",{className:"text-center py-2",children:"Min Required"}),e.jsx("th",{className:"text-center py-2",children:"Status"})]})}),e.jsx("tbody",{children:t.lowStockProducts.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"py-3 font-medium",children:s.name}),e.jsx("td",{className:"py-3",children:s.model}),e.jsx("td",{className:"py-3",children:s.category}),e.jsx("td",{className:"py-3 text-center",children:s.currentStock}),e.jsx("td",{className:"py-3 text-center",children:s.minStock}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.currentStock===0?"bg-red-100 text-red-800":"bg-orange-100 text-orange-800"}`,children:s.currentStock===0?"Out of Stock":"Low Stock"})})]},s.id))})]})})]})]}):e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"No dashboard data available"})})};export{be as default};
