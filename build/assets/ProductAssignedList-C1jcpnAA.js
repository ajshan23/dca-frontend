import{r as a,J as B,T as P,j as t}from"./index-kzRICtfs.js";import{A as F}from"./AdaptableCard-BdYpbCgc.js";import"./Views-Ci-LTHkA.js";import{B as x}from"./Card-DkmweRXp.js";import"./chart.config-DVAkeBmp.js";import"./index-CyfoTzQV.js";import{B as o}from"./Button-DbJpyhqa.js";import{t as M,N as T,D as G}from"./Upload-acBsy-BA.js";import{D as $}from"./DataTable-b7k2B-as.js";import{I as q}from"./hoist-non-react-statics.cjs-C4gm_DLx.js";import"./SvgIcon-WMBk5CHu.js";import{S as N}from"./index-D4rPrOl-.js";import{v as z,B as H,u as Q}from"./index-BygnDPtq.js";import{u as V}from"./useQuery-DkajOui_.js";import{u as U}from"./useMutation-DRqA_CdR.js";import{d as J}from"./debounce-CbrCVYOw.js";import{g as K,b as X}from"./ProductService-DMTzT3SV.js";import"./Alert-DK9tQTFN.js";import"./index-Bt0Yb-r7.js";import"./Drawer-BW_-PqKi.js";import"./index-D0X9BQ0L.js";import"./index-DDezXe6D.js";import"./ScrollBar-CuHcNgzF.js";import{b as W}from"./index-AVcbF-FP.js";import"./index-Chjiymov.js";import"./toString-sKBu7HMn.js";import"./proxy-CYvtYDGf.js";import"./CloseButton-BZdBmBo3.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-HvCNmWxY.js";import"./_getPrototype-CrfAOGpe.js";const Y=()=>{var j,f,y;const A=a.useRef(null),g=B(),w=P(),[h,C]=a.useState(""),[r,d]=a.useState({page:1,limit:10}),[m,S]=a.useState(!1),[s,l]=a.useState({open:!1,assignment:null,condition:"GOOD",inventoryStatus:"AVAILABLE"}),{data:i,isLoading:I,error:p,refetch:R}=V({queryKey:["active-assignments",r,h,m],queryFn:()=>X({page:r.page,limit:r.limit,search:h,overdue:m})}),v=U({mutationFn:e=>K(e.assignmentId,{condition:e.condition,notes:e.notes,inventoryStatus:e.inventoryStatus}),onSuccess:()=>{u("Product returned successfully","success"),w.invalidateQueries(["active-assignments"]),c()},onError:e=>{var n,b;u(((b=(n=e.response)==null?void 0:n.data)==null?void 0:b.message)||"Failed to return product","danger")}}),u=(e,n)=>{M.push(t.jsx(T,{title:n==="success"?"Success":"Error",type:n,children:e}))},k=a.useMemo(()=>J(e=>{C(e),d(n=>({...n,page:1}))},500),[]),c=()=>{l({open:!1,assignment:null,condition:"GOOD",inventoryStatus:"AVAILABLE"})},D=e=>{l({...s,open:!0,assignment:{id:e.id,productName:e.product.name,inventoryInfo:e.inventory.serialNumber||`Item #${e.inventory.id}`}})},L=async()=>{var e;if(!((e=s.assignment)!=null&&e.id)){u("No valid assignment selected","danger");return}await v.mutateAsync({assignmentId:s.assignment.id,condition:s.condition,inventoryStatus:s.inventoryStatus,notes:`Returned in ${s.condition.toLowerCase()} condition. Inventory status: ${s.inventoryStatus.toLowerCase()}`})},O=e=>e.isOverdue?t.jsxs(x,{className:"w-fit bg-red-500 text-white",children:["Overdue (",e.daysOverdue," days)"]}):t.jsx(x,{className:"w-fit bg-blue-500 text-white",children:"Assigned"}),E=a.useMemo(()=>[{header:"Product",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold block",children:e.row.original.product.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.product.model})]})},{header:"Inventory Item",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"block",children:e.row.original.inventory.serialNumber||`Item #${e.row.original.inventory.id}`}),t.jsx(x,{className:"text-xs bg-gray-100 text-gray-700 mt-1",children:e.row.original.inventory.condition})]})},{header:"Category",cell:e=>e.row.original.product.category.name},{header:"Branch",cell:e=>e.row.original.product.branch.name},{header:"Assigned To",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"block",children:e.row.original.employee.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.employee.empId})]})},{header:"Assigned By",cell:e=>e.row.original.assignedBy.username},{header:"Assigned At",cell:e=>new Date(e.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:e=>t.jsx("div",{children:e.row.original.expectedReturnAt?t.jsxs("div",{children:[t.jsx("span",{className:"block",children:new Date(e.row.original.expectedReturnAt).toLocaleDateString()}),e.row.original.isOverdue&&t.jsx("span",{className:"text-xs text-red-500",children:"Overdue"})]}):"-"})},{header:"Status",cell:e=>O(e.row.original)},{header:"Actions",id:"action",cell:e=>{const n=e.row.original;return t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(o,{size:"xs",icon:t.jsx(z,{}),onClick:()=>g(`/products/view/${n.product.id}`)}),t.jsx(o,{size:"xs",variant:"solid",icon:t.jsx(W,{}),onClick:()=>D(n),children:"Return"})]})}}],[g]);return p?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-red-500",children:["Error: ",p.message]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[t.jsxs("div",{className:"flex gap-4 flex-1",children:[t.jsx(q,{placeholder:"Search assignments...",onChange:e=>k(e.target.value),className:"max-w-md"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"overdue-filter",checked:m,onChange:e=>S(e.target.checked),className:"rounded"}),t.jsx("label",{htmlFor:"overdue-filter",className:"text-sm",children:"Show overdue only"})]})]}),t.jsx(o,{icon:t.jsx(H,{}),onClick:()=>R(),children:"Refresh"})]}),t.jsx($,{ref:A,columns:E,data:((j=i==null?void 0:i.data)==null?void 0:j.data)||[],loading:I,pagingData:{total:((y=(f=i==null?void 0:i.data)==null?void 0:f.pagination)==null?void 0:y.total)||0,pageIndex:r.page,pageSize:r.limit},onPaginationChange:e=>d(n=>({...n,page:e})),onSelectChange:e=>d({page:1,limit:e})}),t.jsxs(G,{isOpen:s.open,onClose:c,onRequestClose:c,width:500,children:[t.jsx("h4",{className:"mb-4",children:"Return Product"}),s.assignment&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),t.jsx("p",{className:"font-semibold",children:s.assignment.productName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Inventory Item"}),t.jsx("p",{className:"text-gray-600",children:s.assignment.inventoryInfo})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Return Condition"}),t.jsx(N,{value:{value:s.condition,label:s.condition.charAt(0).toUpperCase()+s.condition.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:e=>l({...s,condition:e.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Inventory Status After Return"}),t.jsx(N,{value:{value:s.inventoryStatus,label:s.inventoryStatus.charAt(0).toUpperCase()+s.inventoryStatus.slice(1).toLowerCase()},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Needs Maintenance"},{value:"DAMAGED",label:"Damaged"}],onChange:e=>l({...s,inventoryStatus:e.value})}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the status for the inventory item after return"})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx(o,{variant:"plain",onClick:c,children:"Cancel"}),t.jsx(o,{variant:"solid",onClick:L,loading:v.isLoading,icon:t.jsx(Q,{}),children:"Confirm Return"})]})]})]})]})},ke=()=>t.jsxs(F,{className:"h-full",bodyClass:"h-full",children:[t.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:t.jsx("h3",{className:"mb-4 lg:mb-0",children:"Product Assignments"})}),t.jsx(Y,{})]});export{ke as default};
