import{J as H,r as K,j as e}from"./index-D_YIX-Ox.js";import{F as W,a as n}from"./Alert-CB58CmAM.js";import{B as b}from"./Button-DcKGCkfz.js";import{F as Q,c as T,a as J,b as l,e as R,f as U,g as d,d as I}from"./index.esm-sfHfDDEe.js";import"./index-7L3RWmp_.js";import{S as k}from"./index-BZbN4UIS.js";import{t as B,N as $}from"./Upload-DhUXxbzP.js";import{C as E}from"./Card-DXaZmEVf.js";import{C as X}from"./index-BH1eNlEP.js";import"./Drawer-sYLjoLO9.js";import"./index-BTUAY-N0.js";import{I as c}from"./hoist-non-react-statics.cjs-CA11qN6p.js";import"./index-BVlj2W2v.js";import"./ScrollBar-JHNdeiNl.js";import{A as Y}from"./AdaptableCard-CirrnjOA.js";import"./Views-Cg_sEl-Z.js";import"./chart.config-BzET5j7p.js";import{D as Z,A as _}from"./index-Cm2b-jJM.js";import"./DataTable-m8Ospbjx.js";import"./SvgIcon-CLxzgJ8G.js";import{i as V}from"./ProductService-BqbgIPXX.js";import{u as C}from"./useQuery-BYVprWpT.js";import{a as ee}from"./CategoryService-BXSTa-_n.js";import{a as ae}from"./BranchService-BFqz1i5Y.js";import{a as re}from"./DepartmentService-mzWRRsFg.js";import"./toString-DzFuzZUs.js";import"./proxy-UnyHbiy9.js";import"./CloseButton-DMZwy_sj.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-BxCCtPYl.js";import"./index-Chjiymov.js";import"./useThemeClass-YIiacJVh.js";const te=T().shape({name:I().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:I().required("Model is required"),categoryId:d().required("Category is required"),branchId:d().required("Branch is required"),warrantyDuration:d().nullable().min(0,"Warranty duration cannot be negative").max(120,"Warranty duration cannot exceed 120 months"),minStockLevel:d().min(0,"Minimum stock level cannot be negative"),initialStock:d().min(0,"Initial stock cannot be negative").max(1e3,"Initial stock cannot exceed 1000"),purchasePrice:d().nullable().min(0,"Purchase price cannot be negative"),serialNumbers:U().of(I().trim())}),Oe=()=>{const v=H(),[j,O]=K.useState(!1),{data:f,isLoading:P,error:L}=C({queryKey:["categories"],queryFn:()=>ee({page:1,limit:100})}),{data:S,isLoading:w,error:D}=C({queryKey:["branches"],queryFn:()=>ae({page:1,limit:100})}),{data:N,isLoading:M,error:ie}=C({queryKey:["departments"],queryFn:()=>re({page:1,limit:100})}),z=async(r,{setSubmitting:i})=>{var x,t,m,p,h,u;i(!0);try{const s={name:r.name.trim(),model:r.model.trim(),categoryId:Number(r.categoryId),branchId:Number(r.branchId),departmentId:r.departmentId?Number(r.departmentId):void 0,warrantyDuration:r.warrantyDuration?Number(r.warrantyDuration):void 0,complianceStatus:!!r.complianceStatus,description:((x=r.description)==null?void 0:x.trim())||void 0,minStockLevel:Number(r.minStockLevel)||0,initialStock:Number(r.initialStock)||0,serialNumbers:((t=r.serialNumbers)==null?void 0:t.filter(g=>g.trim()))||[],purchaseDate:r.purchaseDate||void 0,purchasePrice:r.purchasePrice?Number(r.purchasePrice):void 0,location:((m=r.location)==null?void 0:m.trim())||void 0},o=await V(s);if(o.status===201)B.push(e.jsx($,{title:"Success",type:"success",children:((p=o.data)==null?void 0:p.message)||"Product created successfully"})),v("/products");else throw new Error(o.message||"Failed to create product")}catch(s){console.error("Product creation error:",s);let o="Failed to create product";(u=(h=s.response)==null?void 0:h.data)!=null&&u.message?o=s.response.data.message:s.message&&(o=s.message),B.push(e.jsx($,{title:"Error",type:"danger",children:o}))}finally{i(!1)}};return e.jsxs(Y,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("h3",{children:"Create New Product"})}),e.jsx(Q,{initialValues:{name:"",model:"",categoryId:"",branchId:"",departmentId:"",warrantyDuration:"",complianceStatus:!1,description:"",minStockLevel:0,initialStock:0,serialNumbers:[""],purchaseDate:"",purchasePrice:"",location:""},validationSchema:te,onSubmit:z,children:({touched:r,errors:i,isSubmitting:x,values:t,setFieldValue:m})=>{var s,o,g,q,F,A;const p=((s=f==null?void 0:f.data)==null?void 0:s.data)||[],h=((o=S==null?void 0:S.data)==null?void 0:o.data)||[],u=((g=N==null?void 0:N.data)==null?void 0:g.data)||[];return e.jsx(J,{children:e.jsxs(W,{children:[e.jsxs(E,{className:"mb-6",children:[e.jsx("h4",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Product Name",invalid:!!i.name&&r.name,errorMessage:i.name,children:e.jsx(l,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:c})}),e.jsx(n,{label:"Model",invalid:!!i.model&&r.model,errorMessage:i.model,children:e.jsx(l,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:c})}),e.jsxs(n,{label:"Category",invalid:!!i.categoryId&&r.categoryId,errorMessage:i.categoryId,children:[e.jsx(k,{placeholder:P?"Loading...":"Select Category",loading:P,options:p.map(a=>({value:a.id,label:a.name})),value:t.categoryId?{value:t.categoryId,label:(q=p.find(a=>a.id===t.categoryId))==null?void 0:q.name}:null,onChange:a=>m("categoryId",a==null?void 0:a.value)}),L&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",L.message]})]}),e.jsxs(n,{label:"Branch",invalid:!!i.branchId&&r.branchId,errorMessage:i.branchId,children:[e.jsx(k,{placeholder:w?"Loading...":"Select Branch",loading:w,options:h.map(a=>({value:a.id,label:a.name})),value:t.branchId?{value:t.branchId,label:(F=h.find(a=>a.id===t.branchId))==null?void 0:F.name}:null,onChange:a=>m("branchId",a==null?void 0:a.value)}),D&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",D.message]})]}),e.jsx(n,{label:"Department (Optional)",children:e.jsx(k,{placeholder:M?"Loading...":"Select Department",loading:M,options:u.map(a=>({value:a.id,label:a.name})),value:t.departmentId?{value:t.departmentId,label:(A=u.find(a=>a.id===t.departmentId))==null?void 0:A.name}:null,onChange:a=>m("departmentId",a==null?void 0:a.value),isClearable:!0})}),e.jsx(n,{label:"Warranty Duration (months)",invalid:!!i.warrantyDuration&&r.warrantyDuration,errorMessage:i.warrantyDuration,children:e.jsx(l,{type:"number",name:"warrantyDuration",placeholder:"e.g., 12, 24, 36",component:c,min:"0",max:"120"})}),e.jsx(n,{label:"Minimum Stock Level",invalid:!!i.minStockLevel&&r.minStockLevel,errorMessage:i.minStockLevel,children:e.jsx(l,{type:"number",name:"minStockLevel",placeholder:"Minimum stock threshold",component:c,min:"0"})}),e.jsx(n,{label:"Compliance Status",children:e.jsx(X,{name:"complianceStatus",checked:t.complianceStatus,onChange:a=>m("complianceStatus",a),children:"Compliant"})}),e.jsx(n,{label:"Description",children:e.jsx(l,{as:"textarea",name:"description",placeholder:"Additional description",className:"w-full h-20 p-2 border rounded"})})]})]}),e.jsxs(E,{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Initial Stock (Optional)"}),e.jsxs(b,{type:"button",variant:"plain",onClick:()=>O(!j),children:[j?"Hide":"Add"," Initial Stock"]})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Initial Stock Quantity",invalid:!!i.initialStock&&r.initialStock,errorMessage:i.initialStock,children:e.jsx(l,{type:"number",name:"initialStock",placeholder:"Number of items",component:c,min:"0",max:"1000"})}),e.jsx(n,{label:"Purchase Date",children:e.jsx(l,{type:"date",name:"purchaseDate",component:c})}),e.jsx(n,{label:"Purchase Price per Item",invalid:!!i.purchasePrice&&r.purchasePrice,errorMessage:i.purchasePrice,children:e.jsx(l,{type:"number",name:"purchasePrice",placeholder:"Price per item",component:c,min:"0",step:"0.01"})}),Number(t.initialStock)>0&&e.jsx("div",{className:"md:col-span-2",children:e.jsx(n,{label:`Serial Numbers (Optional - ${t.serialNumbers.length} of ${t.initialStock})`,children:e.jsx(R,{name:"serialNumbers",children:({push:a,remove:G})=>e.jsxs("div",{className:"space-y-2",children:[t.serialNumbers.map((ne,y)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{type:"text",name:`serialNumbers.${y}`,placeholder:`Serial number ${y+1}`,component:c,className:"flex-1"}),t.serialNumbers.length>1&&e.jsx(b,{type:"button",size:"sm",variant:"plain",icon:e.jsx(Z,{}),onClick:()=>G(y)})]},y)),t.serialNumbers.length<Number(t.initialStock)&&e.jsx(b,{type:"button",size:"sm",variant:"plain",icon:e.jsx(_,{}),onClick:()=>a(""),children:"Add Serial Number"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add serial numbers for trackable items. Leave empty for non-serialized items."})]})})})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(b,{type:"button",onClick:()=>v(-1),children:"Cancel"}),e.jsx(b,{variant:"solid",type:"submit",loading:x,children:"Create Product"})]})]})})}})]})};export{Oe as default};
