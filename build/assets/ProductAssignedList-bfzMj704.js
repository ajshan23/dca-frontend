import{r as i,J as E,T as P,j as t}from"./index-Dt7dR0Kg.js";import{A as B}from"./AdaptableCard-X1wjUtdZ.js";import"./Views-CvwUb4li.js";import{S as b}from"./index-BjQxJS07.js";import"./chart.config-D4rwwfz-.js";import"./index-Dr1hlu4K.js";import{B as o}from"./Button-Brtlzr7T.js";import{t as F,N as M,D as T}from"./Upload-Ck1YyE9a.js";import{D as G}from"./DataTable-lllXidWL.js";import{I as $}from"./hoist-non-react-statics.cjs-OkDiBAWr.js";import"./SvgIcon-uxF8xRNP.js";import{w as q,C as z,v as H}from"./index-CKzkT0Bg.js";import{u as Q}from"./useQuery-ntv7hRRy.js";import{u as V}from"./useMutation-DgQzK4i1.js";import{d as U}from"./debounce-BKHbjwzs.js";import{g as J,b as K}from"./ProductService-DbBo0p3C.js";import"./Alert-Cea_Z81E.js";import"./Card-CkM_VVZn.js";import"./index-CC8ClxGc.js";import"./Drawer-BeJWtArK.js";import"./index-_YEJ5m1d.js";import"./index-Br9FsOqT.js";import"./ScrollBar-DLb0NFVY.js";import{b as X}from"./index-CcTxFALe.js";import"./index-Chjiymov.js";import"./toString-DenH1GDR.js";import"./proxy-D03qd06F.js";import"./CloseButton-B1m4okyZ.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-DK3-PSoE.js";import"./_getPrototype-WYUdQZKR.js";const W=()=>{var v,j,f;const N=i.useRef(null),x=E(),w=P(),[h,A]=i.useState(""),[r,d]=i.useState({page:1,limit:10}),[m,C]=i.useState(!1),[s,l]=i.useState({open:!1,assignment:null,condition:"GOOD",inventoryStatus:"AVAILABLE"}),{data:a,isLoading:S,error:g,refetch:I}=Q({queryKey:["active-assignments",r,h,m],queryFn:()=>K({page:r.page,limit:r.limit,search:h,overdue:m})}),p=V({mutationFn:e=>J(e.assignmentId,{condition:e.condition,notes:e.notes,inventoryStatus:e.inventoryStatus}),onSuccess:()=>{u("Product returned successfully","success"),w.invalidateQueries(["active-assignments"]),c()},onError:e=>{var n,y;u(((y=(n=e.response)==null?void 0:n.data)==null?void 0:y.message)||"Failed to return product","danger")}}),u=(e,n)=>{F.push(t.jsx(M,{title:n==="success"?"Success":"Error",type:n,children:e}))},R=i.useMemo(()=>U(e=>{A(e),d(n=>({...n,page:1}))},500),[]),c=()=>{l({open:!1,assignment:null,condition:"GOOD",inventoryStatus:"AVAILABLE"})},k=e=>{l({...s,open:!0,assignment:{id:e.id,productName:e.product.name,inventoryInfo:e.inventory.serialNumber||`Item #${e.inventory.id}`}})},D=async()=>{var e;if(!((e=s.assignment)!=null&&e.id)){u("No valid assignment selected","danger");return}await p.mutateAsync({assignmentId:s.assignment.id,condition:s.condition,inventoryStatus:s.inventoryStatus,notes:`Returned in ${s.condition.toLowerCase()} condition. Inventory status: ${s.inventoryStatus.toLowerCase()}`})},L=e=>e.isOverdue?t.jsxs("div",{className:"w-fit  text-white",children:["Overdue (",e.daysOverdue," days)"]}):t.jsx("div",{className:"w-fit  text-white",children:"Assigned"}),O=i.useMemo(()=>[{header:"Product",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold block",children:e.row.original.product.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.product.model})]})},{header:"Inventory Item",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"block",children:e.row.original.inventory.serialNumber||`Item #${e.row.original.inventory.id}`}),t.jsx("div",{className:"text-xs  text-gray-700 mt-1",children:e.row.original.inventory.condition})]})},{header:"Category",cell:e=>e.row.original.product.category.name},{header:"Branch",cell:e=>e.row.original.product.branch.name},{header:"Assigned To",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"block",children:e.row.original.employee.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.employee.empId})]})},{header:"Assigned By",cell:e=>e.row.original.assignedBy.username},{header:"Assigned At",cell:e=>new Date(e.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:e=>t.jsx("div",{children:e.row.original.expectedReturnAt?t.jsxs("div",{children:[t.jsx("span",{className:"block",children:new Date(e.row.original.expectedReturnAt).toLocaleDateString()}),e.row.original.isOverdue&&t.jsx("span",{className:"text-xs text-red-500",children:"Overdue"})]}):"-"})},{header:"Status",cell:e=>L(e.row.original)},{header:"Actions",id:"action",cell:e=>{const n=e.row.original;return t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(o,{size:"xs",icon:t.jsx(q,{}),onClick:()=>x(`/products/view/${n.product.id}`)}),t.jsx(o,{size:"xs",variant:"solid",icon:t.jsx(X,{}),onClick:()=>k(n),children:"Return"})]})}}],[x]);return g?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-red-500",children:["Error: ",g.message]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[t.jsxs("div",{className:"flex gap-4 flex-1",children:[t.jsx($,{placeholder:"Search assignments...",onChange:e=>R(e.target.value),className:"max-w-md"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"overdue-filter",checked:m,onChange:e=>C(e.target.checked),className:"rounded"}),t.jsx("label",{htmlFor:"overdue-filter",className:"text-sm",children:"Show overdue only"})]})]}),t.jsx(o,{icon:t.jsx(z,{}),onClick:()=>I(),children:"Refresh"})]}),t.jsx(G,{ref:N,columns:O,data:((v=a==null?void 0:a.data)==null?void 0:v.data)||[],loading:S,pagingData:{total:((f=(j=a==null?void 0:a.data)==null?void 0:j.pagination)==null?void 0:f.total)||0,pageIndex:r.page,pageSize:r.limit},onPaginationChange:e=>d(n=>({...n,page:e})),onSelectChange:e=>d({page:1,limit:e})}),t.jsxs(T,{isOpen:s.open,onClose:c,onRequestClose:c,width:500,children:[t.jsx("h4",{className:"mb-4",children:"Return Product"}),s.assignment&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),t.jsx("p",{className:"font-semibold",children:s.assignment.productName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Inventory Item"}),t.jsx("p",{className:"text-gray-600",children:s.assignment.inventoryInfo})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Return Condition"}),t.jsx(b,{value:{value:s.condition,label:s.condition.charAt(0).toUpperCase()+s.condition.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:e=>l({...s,condition:e.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Inventory Status After Return"}),t.jsx(b,{value:{value:s.inventoryStatus,label:s.inventoryStatus.charAt(0).toUpperCase()+s.inventoryStatus.slice(1).toLowerCase()},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Needs Maintenance"},{value:"DAMAGED",label:"Damaged"}],onChange:e=>l({...s,inventoryStatus:e.value})}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the status for the inventory item after return"})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx(o,{variant:"plain",onClick:c,children:"Cancel"}),t.jsx(o,{variant:"solid",onClick:D,loading:p.isLoading,icon:t.jsx(H,{}),children:"Confirm Return"})]})]})]})]})},Re=()=>t.jsxs(B,{className:"h-full",bodyClass:"h-full",children:[t.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:t.jsx("h3",{className:"mb-4 lg:mb-0",children:"Product Assignments"})}),t.jsx(W,{})]});export{Re as default};
