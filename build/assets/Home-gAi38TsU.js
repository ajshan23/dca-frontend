import{r as m,h as I,j as e,J as P}from"./index-D_YIX-Ox.js";import{C as d}from"./Card-DXaZmEVf.js";import{a as E,b as T,c as z,d as R,A as J,C as f}from"./chart.config-BzET5j7p.js";import{B as N}from"./Button-DcKGCkfz.js";import{u as w}from"./useQuery-BYVprWpT.js";import{a as V,b as $,c as F}from"./ProductService-BqbgIPXX.js";import{t as B,u as G,v as H}from"./index-Cm2b-jJM.js";import{B as K}from"./index-BjwJnWqf.js";import{M as W,a as Q}from"./index-BbIwPjDL.js";import{C as Y}from"./ClipLoader-WcStEm6k.js";import"./index-Chjiymov.js";const M=["line","bar","area"],_=x=>{const{series:o=[],width:b="100%",height:a=300,xAxis:v,customOptions:u,type:r="line",direction:g,donutTitle:n,donutText:y,className:t,...j}=x,l=m.useRef(null),k=m.useMemo(()=>{switch(r){case"line":return E;case"bar":return R;case"area":return z;case"donut":return T;default:return E}},[r]);let i=JSON.parse(JSON.stringify(k));const h=window.innerWidth<768,p=m.useCallback(()=>{if(l.current){const c=l.current.querySelectorAll("div.apexcharts-legend")[0];g===I&&(c.style.right="auto",c.style.left="0"),h&&(c.style.position="relative",c.style.top="0",c.style.justifyContent="start",c.style.padding="0")}},[g,h]);return m.useEffect(()=>{M.includes(r)&&p()},[r,p]),M.includes(r)&&(i.xaxis.categories=v),u&&(i={...i,...u}),r==="donut"&&(n&&(i.plotOptions.pie.donut.labels.total.label=n),y&&(i.plotOptions.pie.donut.labels.total.formatter=()=>y)),e.jsx("div",{ref:l,style:g===I?{direction:"ltr"}:{},className:"chartRef",children:e.jsx(J,{options:i,type:r,series:o,width:b,height:a,className:t,...j})})},ce=()=>{var p,c,S,A,O,C,D,L;const x=P(),[o,b]=m.useState(null);m.useEffect(()=>{const s=localStorage.getItem("user");if(s)try{b(JSON.parse(s))}catch(q){console.error("Error parsing user data:",q)}},[]);const{data:a,isLoading:v,error:u}=w({queryKey:["stock-summary"],queryFn:V}),{data:r,isLoading:g}=w({queryKey:["recent-assignments"],queryFn:()=>$({page:1,limit:5})}),{data:n,isLoading:y}=w({queryKey:["assignment-analytics"],queryFn:()=>F()}),t=((p=a==null?void 0:a.data)==null?void 0:p.data)||(a==null?void 0:a.data),j=((S=(c=r==null?void 0:r.data)==null?void 0:c.data)==null?void 0:S.data)||((A=r==null?void 0:r.data)==null?void 0:A.data)||[],l=((O=n==null?void 0:n.data)==null?void 0:O.data)||(n==null?void 0:n.data),k=v||g||y;if(m.useEffect(()=>{console.log("Stock Summary Response:",a),console.log("Extracted Stock Summary:",t)},[a,t]),k)return e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(Y,{color:"#3b82f6",size:50,speedMultiplier:.8})});if(u)return e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsxs("p",{className:"text-red-500",children:["Failed to load dashboard data: ",u.message]})});if(!t)return e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx("p",{className:"text-gray-500",children:"No dashboard data available"}),e.jsxs("div",{className:"mt-4 text-xs text-gray-400",children:["Debug: ",JSON.stringify({stockSummaryResponse:!!a,hasData:!!(a!=null&&a.data)})]})]});const i={series:Object.values(t.stockByStatus||{}),labels:Object.keys(t.stockByStatus||{})},h=j.filter(s=>s.isOverdue);return e.jsxs("div",{className:"flex flex-col gap-6 h-full p-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",children:["Welcome back, ",(o==null?void 0:o.name)||(o==null?void 0:o.username)||"User","!"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["You're managing ",t.totalProducts||0," products with ",t.totalInventory||0," inventory items"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalProducts||0})]}),e.jsx(K,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Available Stock"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((C=t.stockByStatus)==null?void 0:C.AVAILABLE)||0})]}),e.jsx(W,{className:"h-8 w-8 text-green-500"})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Assignments"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(l==null?void 0:l.activeAssignments)||0})]}),e.jsx(Q,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Low Stock Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.lowStockCount||0})]}),e.jsx(B,{className:"h-8 w-8 text-orange-500"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"lg:col-span-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Inventory Status Distribution"})}),i.series.length>0?e.jsx(_,{series:[{name:"Inventory Items",data:i.series}],xAxis:i.labels,height:300,type:"bar",customOptions:{colors:[f[0],f[1],f[2],f[3],f[4]],legend:{show:!0,position:"top"},plotOptions:{bar:{distributed:!0}}}}):e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"No inventory data available"})]}),e.jsxs(d,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Alerts & Status"}),e.jsxs("div",{className:"space-y-4",children:[(t.lowStockCount||0)>0&&e.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-300",children:"Low Stock Warning"})]}),e.jsxs("p",{className:"text-xs text-orange-700 dark:text-orange-400",children:[t.lowStockCount," products are below minimum stock level"]}),e.jsx(N,{size:"xs",className:"mt-2",onClick:()=>x("/products?stockStatus=low"),children:"View Products"})]}),h.length>0&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Overdue Returns"})]}),e.jsxs("p",{className:"text-xs text-red-700 dark:text-red-400",children:[h.length," assignments are overdue"]}),e.jsx(N,{size:"xs",className:"mt-2",onClick:()=>x("/assignments?overdue=true"),children:"View Assignments"})]}),(t.lowStockCount||0)===0&&h.length===0&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"All Systems Normal"})]}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400",children:"No immediate attention required"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Return Rate:"}),e.jsxs("span",{className:"font-medium",children:[(l==null?void 0:l.returnRate)||"0","%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Damaged Items:"}),e.jsx("span",{className:"font-medium",children:((D=t.stockByStatus)==null?void 0:D.DAMAGED)||0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"In Maintenance:"}),e.jsx("span",{className:"font-medium",children:((L=t.stockByStatus)==null?void 0:L.MAINTENANCE)||0})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Assignments"}),e.jsx(N,{size:"xs",onClick:()=>x("/assignments"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:j.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent assignments"}):j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["To: ",s.employee.name," (",s.employee.empId,")"]}),e.jsxs("p",{children:["Item: ",s.inventory.serialNumber||`#${s.inventory.id}`]}),e.jsx("p",{children:new Date(s.assignedAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.isOverdue?"text-red-600":"text-blue-600"}`,children:s.isOverdue?`Overdue (${s.daysOverdue}d)`:"Active"})]},s.id))})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Stock Activity"}),e.jsx(N,{size:"xs",onClick:()=>x("/products/transactions/history"),children:"View All"})]}),e.jsx("div",{className:"space-y-3",children:!t.recentTransactions||t.recentTransactions.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent transactions"}):t.recentTransactions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.inventory.product.name}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:s.reason}),e.jsx("p",{children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.type==="IN"?"text-green-600":s.type==="OUT"?"text-blue-600":"text-gray-600"}`,children:s.type})]},s.id))})]})]}),t.lowStockProducts&&t.lowStockProducts.length>0&&e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Products Requiring Attention"}),e.jsx(N,{size:"xs",onClick:()=>x("/products?stockStatus=low"),children:"Manage Stock"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2",children:"Product"}),e.jsx("th",{className:"text-left py-2",children:"Model"}),e.jsx("th",{className:"text-center py-2",children:"Current Stock"}),e.jsx("th",{className:"text-center py-2",children:"Min Required"}),e.jsx("th",{className:"text-center py-2",children:"Status"})]})}),e.jsx("tbody",{children:t.lowStockProducts.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-3 font-medium",children:s.name}),e.jsx("td",{className:"py-3",children:s.model}),e.jsx("td",{className:"py-3 text-center",children:s.currentStock}),e.jsx("td",{className:"py-3 text-center",children:s.minStock}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${s.currentStock===0?"text-red-600":"text-orange-600"}`,children:s.currentStock===0?"Out of Stock":"Low Stock"})})]},s.id))})]})})]})]})};export{ce as default};
