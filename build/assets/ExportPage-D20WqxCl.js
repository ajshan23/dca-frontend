import{r as d,j as a}from"./index-CRLhe4UJ.js";import{F as J,a as i}from"./Alert-DqTPxGto.js";import"./index-B8bJU2zV.js";import{S as c}from"./index-BPAnroHB.js";import{B as h}from"./Button-8wmeFP59.js";import{D as Y,a as q,t as P,N as L,b as u}from"./Upload-BsdIaWhn.js";import{C as Q}from"./Card-C9ZImza0.js";import{C as V}from"./index-B0PN-9QH.js";import"./index-BnYNxHWj.js";import"./hoist-non-react-statics.cjs-h-IznSOP.js";import"./index-CT8fCIvY.js";import"./ScrollBar-Bv1uJUI5.js";import{f as I,a1 as R,a2 as U}from"./index-IkMseqAw.js";import{u as j}from"./useQuery-x5c111Hj.js";import{a as _}from"./CategoryService-DK6GOe_E.js";import{a as z}from"./BranchService-BRuZa8tG.js";import{a as W}from"./DepartmentService-CIbSblW3.js";import{a as X}from"./EmployeeService.ts-D39EZGYe.js";import{u as Z,v as ee}from"./ProductService-DuAS4pFV.js";import"./toString-D-v_3TrA.js";import"./Views-kvwvgnoa.js";import"./CloseButton-3K3Gy7SU.js";import"./_getPrototype-xGtM0kyU.js";import"./index-Chjiymov.js";const ae=({isOpen:v,onClose:m,type:n})=>{const[t,x]=d.useState({fromDate:null,toDate:null,month:"",year:"",employeeId:"",productId:"",categoryId:"",branchId:"",departmentId:"",status:"",stockStatus:"",complianceStatus:"",format:"all",includeInventory:!1}),[s,D]=d.useState(!1),{data:b}=j({queryKey:["categories-for-export"],queryFn:()=>_({page:1,limit:100})}),{data:g}=j({queryKey:["branches-for-export"],queryFn:()=>z({page:1,limit:100})}),{data:f}=j({queryKey:["departments-for-export"],queryFn:()=>W({page:1,limit:100})}),{data:y}=j({queryKey:["employees-for-export"],queryFn:()=>X({page:1,limit:100}),enabled:n==="assignments"}),E=d.useMemo(()=>{var e,r;return((r=(e=b==null?void 0:b.data)==null?void 0:e.data)==null?void 0:r.map(l=>({value:l.id,label:l.name})))||[]},[b]),k=d.useMemo(()=>{var e,r;return((r=(e=g==null?void 0:g.data)==null?void 0:e.data)==null?void 0:r.map(l=>({value:l.id,label:l.name})))||[]},[g]),C=d.useMemo(()=>{var e,r;return((r=(e=f==null?void 0:f.data)==null?void 0:e.data)==null?void 0:r.map(l=>({value:l.id,label:l.name})))||[]},[f]),N=d.useMemo(()=>{var e,r;return((r=(e=y==null?void 0:y.data)==null?void 0:e.data)==null?void 0:r.map(l=>({value:l.id,label:`${l.name} (${l.empId})`})))||[]},[y]),O=d.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:6},(r,l)=>({value:(e-l).toString(),label:(e-l).toString()}))},[]),w=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],A=[{value:"all",label:"All Assignments"},{value:"active",label:"Active Assignments Only"},{value:"history",label:"Returned Assignments Only"}],T=[{value:"",label:"All Statuses"},{value:"ASSIGNED",label:"Assigned"},{value:"RETURNED",label:"Returned"},{value:"OVERDUE",label:"Overdue"}],F=[{value:"",label:"All Stock Levels"},{value:"available",label:"Available Stock"},{value:"low",label:"Low Stock"},{value:"out",label:"Out of Stock"}],o=(e,r)=>{x(l=>({...l,[e]:r}))},B=()=>{x({fromDate:null,toDate:null,month:"",year:"",employeeId:"",productId:"",categoryId:"",branchId:"",departmentId:"",status:"",stockStatus:"",complianceStatus:"",format:"all",includeInventory:!1})},G=async()=>{var e,r;D(!0);try{const l={};t.fromDate&&(l.fromDate=t.fromDate.toISOString().split("T")[0]),t.toDate&&(l.toDate=t.toDate.toISOString().split("T")[0]),t.month&&t.year&&(l.month=t.month,l.year=t.year),t.employeeId&&(l.employeeId=t.employeeId),t.categoryId&&(l.categoryId=t.categoryId),t.branchId&&(l.branchId=t.branchId),t.departmentId&&(l.departmentId=t.departmentId),t.status&&(l.status=t.status),t.stockStatus&&(l.stockStatus=t.stockStatus),t.complianceStatus&&(l.complianceStatus=t.complianceStatus),n==="assignments"&&t.format&&(l.format=t.format),n==="products"&&t.includeInventory&&(l.includeInventory=t.includeInventory.toString());let S;n==="products"?S=await Z(l):S=await ee(l);const $=new Blob([S.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),M=window.URL.createObjectURL($),p=document.createElement("a");p.href=M;const K=new Date().toISOString().split("T")[0],H=n==="products"?"products-report":"assignments-report";p.download=`${H}-${K}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(M),P.push(a.jsxs(L,{title:"Success",type:"success",children:[n==="products"?"Products":"Assignments"," exported successfully!"]})),m()}catch(l){console.error("Export error:",l),P.push(a.jsx(L,{title:"Error",type:"danger",children:((r=(e=l.response)==null?void 0:e.data)==null?void 0:r.message)||`Failed to export ${n}`}))}finally{D(!1)}};return a.jsxs(Y,{isOpen:v,onClose:m,width:600,height:700,closable:!s,children:[a.jsx("div",{className:"flex justify-between items-center mb-4",children:a.jsxs("h4",{className:"text-lg font-semibold",children:["Export ",n==="products"?"Products":"Assignments"," to Excel"]})}),a.jsxs(J,{children:[a.jsxs("div",{className:"max-h-96 overflow-y-auto pr-2 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsx(i,{label:"From Date",children:a.jsx(q,{value:t.fromDate,onChange:e=>o("fromDate",e),placeholder:"Select start date",disabled:s})}),a.jsx(i,{label:"To Date",children:a.jsx(q,{value:t.toDate,onChange:e=>o("toDate",e),placeholder:"Select end date",disabled:s})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsx(i,{label:"Month",children:a.jsx(c,{options:w,value:w.find(e=>e.value===t.month)||null,onChange:e=>o("month",(e==null?void 0:e.value)||""),placeholder:"Select month",isDisabled:s})}),a.jsx(i,{label:"Year",children:a.jsx(c,{options:O,value:O.find(e=>e.value===t.year)||null,onChange:e=>o("year",(e==null?void 0:e.value)||""),placeholder:"Select year",isDisabled:s})})]}),a.jsx(i,{label:"Category",children:a.jsx(c,{options:E,value:E.find(e=>e.value===t.categoryId)||null,onChange:e=>o("categoryId",(e==null?void 0:e.value)||""),placeholder:"Select category",isDisabled:s})}),a.jsx(i,{label:"Branch",children:a.jsx(c,{options:k,value:k.find(e=>e.value===t.branchId)||null,onChange:e=>o("branchId",(e==null?void 0:e.value)||""),placeholder:"Select branch",isDisabled:s})}),a.jsx(i,{label:"Department",children:a.jsx(c,{options:C,value:C.find(e=>e.value===t.departmentId)||null,onChange:e=>o("departmentId",(e==null?void 0:e.value)||""),placeholder:"Select department",isDisabled:s})}),n==="assignments"&&a.jsx(i,{label:"Employee",children:a.jsx(c,{options:N,value:N.find(e=>e.value===t.employeeId)||null,onChange:e=>o("employeeId",(e==null?void 0:e.value)||""),placeholder:"Select employee",isDisabled:s})}),n==="assignments"?a.jsx(i,{label:"Assignment Status",children:a.jsx(c,{options:T,value:T.find(e=>e.value===t.status)||null,onChange:e=>o("status",(e==null?void 0:e.value)||""),placeholder:"Select status",isDisabled:s})}):a.jsx(i,{label:"Stock Status",children:a.jsx(c,{options:F,value:F.find(e=>e.value===t.stockStatus)||null,onChange:e=>o("stockStatus",(e==null?void 0:e.value)||""),placeholder:"Select stock status",isDisabled:s})}),n==="assignments"&&a.jsx(i,{label:"Export Format",children:a.jsx(c,{options:A,value:A.find(e=>e.value===t.format)||null,onChange:e=>o("format",(e==null?void 0:e.value)||"all"),isDisabled:s})}),n==="products"&&a.jsx(i,{children:a.jsx(V,{checked:t.includeInventory,onChange:e=>o("includeInventory",e),disabled:s,children:"Include Inventory Details"})})]}),a.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t",children:[a.jsx(h,{variant:"plain",onClick:B,disabled:s,children:"Clear All"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(h,{variant:"plain",onClick:m,disabled:s,children:"Cancel"}),a.jsx(h,{variant:"solid",icon:a.jsx(I,{}),loading:s,onClick:G,children:"Export to Excel"})]})]})]})]})},ke=()=>{const[v,m]=d.useState("assignments"),[n,t]=d.useState(!1),x=()=>{t(!0)},s=()=>{t(!1)};return a.jsxs("div",{className:"container mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Data Export"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Export your product and assignment data to Excel format for reporting and analysis."})]}),a.jsx(Q,{children:a.jsxs(u,{value:v,onChange:m,children:[a.jsxs(u.TabList,{children:[a.jsx(u.TabNav,{value:"assignments",icon:a.jsx(R,{}),children:"Assignments"}),a.jsx(u.TabNav,{value:"products",icon:a.jsx(U,{}),children:"Products"})]}),a.jsx(u.TabContent,{value:"assignments",className:"p-6",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(R,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Export Assignment Data"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Export assignment records with detailed information including employee assignments, product details, dates, and status information."}),a.jsx(h,{variant:"solid",icon:a.jsx(I,{}),onClick:x,children:"Export Assignments"})]})}),a.jsx(u.TabContent,{value:"products",className:"p-6",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Export Product Data"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Export product information including stock levels, inventory details, and product specifications."}),a.jsx(h,{variant:"solid",icon:a.jsx(I,{}),onClick:x,children:"Export Products"})]})})]})}),a.jsx(ae,{isOpen:n,onClose:s,type:v})]})};export{ke as default};
