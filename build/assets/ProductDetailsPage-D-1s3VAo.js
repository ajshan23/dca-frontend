import{M as pe,J as je,r as c,j as e}from"./index-kzRICtfs.js";import{u as ve}from"./useQuery-DkajOui_.js";import{u as f}from"./useMutation-DRqA_CdR.js";import{j as be,f as Ne,k as ye,l as we}from"./ProductService-DMTzT3SV.js";import"./Alert-DK9tQTFN.js";import"./index-CyfoTzQV.js";import{C as S,B as p}from"./Card-DkmweRXp.js";import{B as l}from"./Button-DbJpyhqa.js";import{t as d,N as m,D as T}from"./Upload-acBsy-BA.js";import"./index-Bt0Yb-r7.js";import"./Drawer-BW_-PqKi.js";import"./index-D0X9BQ0L.js";import{I as j}from"./hoist-non-react-statics.cjs-C4gm_DLx.js";import"./index-DDezXe6D.js";import{S as $}from"./index-D4rPrOl-.js";import"./ScrollBar-CuHcNgzF.js";import{D as U}from"./DataTable-b7k2B-as.js";import{D as fe,z as H,E as Se,F as z,w as Ce}from"./index-BygnDPtq.js";import{M as De,a as ke}from"./index-AVcbF-FP.js";import{B as W}from"./index-JuAKu4LT.js";import{C as Ae}from"./ClipLoader-CWkJ03cV.js";import"./toString-sKBu7HMn.js";import"./proxy-CYvtYDGf.js";import"./Views-Ci-LTHkA.js";import"./CloseButton-BZdBmBo3.js";import"./_getPrototype-CrfAOGpe.js";import"./index-Chjiymov.js";const Ie={AVAILABLE:"bg-green-500 text-white w-fit",ASSIGNED:"bg-blue-500 text-white w-fit",MAINTENANCE:"bg-yellow-500 text-white w-fit",DAMAGED:"bg-red-500 text-white w-fit",RETIRED:"bg-gray-500 text-white w-fit"},V={NEW:"bg-green-500 text-white w-fit",GOOD:"bg-blue-500 text-white w-fit",FAIR:"bg-yellow-500 text-white w-fit",POOR:"bg-orange-500 text-white w-fit",DAMAGED:"bg-red-500 text-white w-fit"},Ee={ASSIGNED:"bg-blue-500 text-white w-fit",RETURNED:"bg-emerald-500 text-white w-fit",OVERDUE:"bg-red-500 text-white w-fit"},nt=()=>{var k,A,I,E,P,L,O,R,M,F,B;const{id:h}=pe(),_=je(),[J,u]=c.useState(!1),[K,v]=c.useState(!1),[n,x]=c.useState(null),[i,b]=c.useState({quantity:1,serialNumbers:[""],purchasePrice:"",location:""}),[g,N]=c.useState(""),{data:o,isLoading:Y,error:C,refetch:D}=ve({queryKey:["product",h],queryFn:()=>we(Number(h)),enabled:!!h}),{mutate:X,isPending:Z}=f({mutationFn:async t=>{const s=await be(t);if(!(s!=null&&s.qrCode))throw new Error("Invalid QR code data received from server");return s.qrCode},onSuccess:t=>{ne(t)},onError:t=>{d.push(e.jsx(m,{title:"Error",type:"danger",children:t.message||"Failed to generate QR code"}))}}),{mutate:ee,isPending:te}=f({mutationFn:t=>Ne(Number(h),t),onSuccess:t=>{var s;d.push(e.jsx(m,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Stock added successfully"})),D(),u(!1),ie()},onError:t=>{var s,r;d.push(e.jsx(m,{title:"Error",type:"danger",children:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to add stock"}))}}),{mutate:se,isPending:ae}=f({mutationFn:t=>ye(t.inventoryId,t.updateData),onSuccess:t=>{var s;d.push(e.jsx(m,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Inventory updated successfully"})),D(),v(!1),x(null)},onError:t=>{var s,r;d.push(e.jsx(m,{title:"Error",type:"danger",children:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update inventory"}))}}),ne=t=>{const s=window.open("","_blank","width=600,height=600");s&&a&&(s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Product QR Code - ${a.name}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .product-info {
                margin-bottom: 20px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>${a.name} QR Code</h2>
            <div class="product-info">
              <p><strong>Model:</strong> ${a.model}</p>
              <p><strong>ID:</strong> ${a.id}</p>
            </div>
            <div class="qr-container">
              <img src="${t}" alt="QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),s.document.close())},ie=()=>{b({quantity:1,serialNumbers:[""],purchasePrice:"",location:""})},re=()=>{const t={quantity:i.quantity,serialNumbers:i.serialNumbers.filter(s=>s.trim()),purchasePrice:i.purchasePrice?Number(i.purchasePrice):void 0,location:i.location.trim()||void 0,reason:"Manual stock addition"};ee(t)},le=t=>{x(t),v(!0)},oe=()=>{n&&se({inventoryId:n.id,updateData:{status:n.status,condition:n.condition,location:n.location,notes:n.notes,reason:"Manual inventory update"}})},a=((k=o==null?void 0:o.data)==null?void 0:k.data)||(o==null?void 0:o.data),y=c.useMemo(()=>{if(!(a!=null&&a.inventory)||!g.trim())return(a==null?void 0:a.inventory)||[];const t=g.toLowerCase().trim();return a.inventory.filter(s=>{var q,G,Q;const r=((q=s.serialNumber)==null?void 0:q.toLowerCase())||"",w=`item #${s.id}`.toLowerCase(),me=s.status.toLowerCase(),he=s.condition.toLowerCase(),ue=((G=s.location)==null?void 0:G.toLowerCase())||"",xe=((Q=s.notes)==null?void 0:Q.toLowerCase())||"",ge=s.purchaseDate?new Date(s.purchaseDate).toLocaleDateString().toLowerCase():"";return r.includes(t)||w.includes(t)||me.includes(t)||he.includes(t)||ue.includes(t)||xe.includes(t)||ge.includes(t)})},[a==null?void 0:a.inventory,g]),ce=[{header:"Serial Number",cell:t=>t.row.original.serialNumber||`Item #${t.row.original.id}`},{header:"Status",cell:t=>e.jsx(p,{className:Ie[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Condition",cell:t=>e.jsx(p,{className:V[t.row.original.condition]||"bg-gray-500 text-white",children:t.row.original.condition})},{header:"Purchase Date",cell:t=>t.row.original.purchaseDate?new Date(t.row.original.purchaseDate).toLocaleDateString():"-"},{header:"Actions",cell:t=>e.jsx(l,{size:"xs",icon:e.jsx(Ce,{}),onClick:()=>le(t.row.original),disabled:t.row.original.status==="ASSIGNED"})}],de=[{header:"Employee",cell:t=>{var s,r;return e.jsxs("span",{children:[((s=t.row.original.employee)==null?void 0:s.name)||"Unknown",((r=t.row.original.employee)==null?void 0:r.empId)&&` (${t.row.original.employee.empId})`]})}},{header:"Inventory Item",cell:t=>{var s,r;return e.jsx("span",{children:((s=t.row.original.inventory)==null?void 0:s.serialNumber)||`Item #${((r=t.row.original.inventory)==null?void 0:r.id)||"N/A"}`})}},{header:"Assigned On",cell:t=>new Date(t.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:t=>t.row.original.expectedReturnAt?new Date(t.row.original.expectedReturnAt).toLocaleDateString():"-"},{header:"Returned On",cell:t=>t.row.original.returnedAt?new Date(t.row.original.returnedAt).toLocaleDateString():"-"},{header:"Status",cell:t=>e.jsx(p,{className:Ee[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Return Condition",cell:t=>t.row.original.returnCondition?e.jsx(p,{className:V[t.row.original.returnCondition]||"bg-gray-500 text-white",children:t.row.original.returnCondition}):e.jsx("span",{children:"-"})},{header:"Assigned By",cell:t=>{var s;return((s=t.row.original.assignedBy)==null?void 0:s.username)||"Unknown"}}];return C&&d.push(e.jsx(m,{title:"Error",type:"danger",children:C.message||"Failed to load product details"})),Y?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ae,{color:"#3B82F6",size:40})}):a?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(l,{variant:"plain",icon:e.jsx(fe,{}),onClick:()=>_(-1),children:"Back to Products"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"twoTone",icon:e.jsx(H,{}),onClick:()=>u(!0),children:"Add Stock"}),e.jsx(l,{variant:"solid",icon:e.jsx(Se,{}),loading:Z,onClick:()=>X(Number(h)),children:"Generate & Print QR"})]})]}),e.jsx(S,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.model}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Category:"}),e.jsx("span",{className:"ml-2",children:((A=a.category)==null?void 0:A.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Branch:"}),e.jsx("span",{className:"ml-2",children:((I=a.branch)==null?void 0:I.name)||"-"})]}),a.department&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Department:"}),e.jsx("span",{className:"ml-2",children:a.department.name})]}),a.warrantyDuration&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Warranty Duration:"}),e.jsxs("span",{className:"ml-2",children:[a.warrantyDuration," months"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Minimum Stock Level:"}),e.jsx("span",{className:"ml-2",children:a.minStockLevel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(a.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx(p,{className:a.complianceStatus?"text-white bg-green-500":"text-white bg-red-500",children:a.complianceStatus?"Compliant":"Non-compliant"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Stock Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Stock:"}),e.jsx("span",{className:"ml-2 font-semibold",children:((E=a.stockStats)==null?void 0:E.totalStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Available:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-600",children:((P=a.stockStats)==null?void 0:P.availableStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assigned:"}),e.jsx("span",{className:"ml-2 font-semibold text-blue-600",children:((L=a.stockStats)==null?void 0:L.assignedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Damaged:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-600",children:((O=a.stockStats)==null?void 0:O.damagedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Maintenance:"}),e.jsx("span",{className:"ml-2 font-semibold text-yellow-600",children:((R=a.stockStats)==null?void 0:R.maintenanceStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Retired:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-600",children:((M=a.stockStats)==null?void 0:M.retiredStock)||0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:a.description||"No description available"})]})]})]})}),e.jsxs(S,{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Inventory Items"})]})}),e.jsx("div",{className:"mb-4 max-w-md",children:e.jsx(j,{placeholder:"Search inventory items...",value:g,onChange:t=>N(t.target.value),prefix:e.jsx(z,{className:"text-gray-400"}),clearButton:!0,onClear:()=>N("")})}),g.trim()&&e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Showing ",y.length," of ",((F=a.inventory)==null?void 0:F.length)||0," items",y.length!==(((B=a.inventory)==null?void 0:B.length)||0)&&e.jsx(l,{variant:"plain",size:"xs",className:"ml-2",onClick:()=>N(""),children:"Clear search"})]}),!a.inventory||a.inventory.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items found for this product"}),e.jsx(l,{className:"mt-4",variant:"solid",icon:e.jsx(H,{}),onClick:()=>u(!0),children:"Add First Stock"})]}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items match your search"}),e.jsx(l,{className:"mt-4",variant:"plain",onClick:()=>N(""),children:"Clear search"})]}):e.jsx(U,{columns:ce,data:y})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Assignment History"})]}),!a.assignments||a.assignments.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No assignments found for this product"})}):e.jsx(U,{columns:de,data:a.assignments})]}),e.jsxs(T,{isOpen:J,onClose:()=>u(!1),width:500,children:[e.jsxs("h4",{className:"mb-4",children:["Add Stock to ",a.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity"}),e.jsx(j,{type:"number",min:"1",max:"100",value:i.quantity,onChange:t=>b({...i,quantity:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Purchase Price per Item (Optional)"}),e.jsx(j,{type:"number",min:"0",step:"0.01",value:i.purchasePrice,onChange:t=>b({...i,purchasePrice:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Serial Numbers (Optional - ",i.serialNumbers.length," of ",i.quantity,")"]}),Array.from({length:i.quantity},(t,s)=>e.jsx(j,{type:"text",placeholder:`Serial number ${s+1}`,value:i.serialNumbers[s]||"",onChange:r=>{const w=[...i.serialNumbers];w[s]=r.target.value,b({...i,serialNumbers:w})},className:"mb-2"},s))]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(l,{variant:"plain",onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:re,loading:te,icon:e.jsx(W,{}),children:"Add Stock"})]})]})]}),e.jsxs(T,{isOpen:K,onClose:()=>v(!1),width:400,children:[e.jsx("h4",{className:"mb-4",children:"Edit Inventory Item"}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsx($,{value:{value:n.status,label:n.status},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Maintenance"},{value:"DAMAGED",label:"Damaged"},{value:"RETIRED",label:"Retired"}],onChange:t=>x({...n,status:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx($,{value:{value:n.condition,label:n.condition},options:[{value:"NEW",label:"New"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"},{value:"DAMAGED",label:"Damaged"}],onChange:t=>x({...n,condition:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx(j,{as:"textarea",value:n.notes||"",onChange:t=>x({...n,notes:t.target.value}),placeholder:"Additional notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(l,{variant:"plain",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:oe,loading:ae,children:"Update"})]})]})]})]}):e.jsx("div",{className:"p-4 text-center",children:"Product not found"})};export{nt as default};
