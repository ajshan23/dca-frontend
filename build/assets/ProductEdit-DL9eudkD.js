import{M as H,J as V,T as X,j as e}from"./index-xBb4Cu5p.js";import{F as Y,a as d}from"./Alert-eifFNp7B.js";import{B as p}from"./Button-DpFfS7qi.js";import{F as Z,c as R,a as ee,b as m,g as x,d as T}from"./index.esm-BSephAUd.js";import"./index-DUchRYx7.js";import{S as f}from"./index-CCxRe_lL.js";import{t as Q,N as W}from"./Upload-Br0nJyki.js";import{C as $}from"./Card-DUFOzyf7.js";import{C as ae}from"./index-B9jXH76y.js";import"./index-DPKcPQiU.js";import{I as g}from"./hoist-non-react-statics.cjs-D9D9Op99.js";import"./index-LBerdN8z.js";import"./ScrollBar--d9coRPU.js";import{A as te}from"./AdaptableCard-C8NAqNcm.js";import"./Views--okuRfCK.js";import"./chart.config-TIV3arlo.js";import"./DataTable-DPSpAcGJ.js";import"./SvgIcon-Bg4gHeyf.js";import{q as re,o as ne}from"./ProductService-CjGHow6K.js";import{a as ie}from"./CategoryService-C_OzfvId.js";import{a as se}from"./BranchService-fe6aG-r_.js";import{a as de}from"./DepartmentService-BKfxgzHq.js";import{u as h}from"./useQuery-C5ra9VKq.js";import{u as oe}from"./useMutation-BmpT8JAn.js";import{C as le}from"./ClipLoader-BCjvYix0.js";import"./toString-CfufOl4R.js";import"./index-CeosE6Mu.js";import"./CloseButton-B3Yr_F5T.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-RCTy2yb6.js";import"./index-Chjiymov.js";import"./useThemeClass-CVZ0ENSo.js";const ce=R().shape({name:T().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:T().required("Model is required"),categoryId:x().required("Category is required"),branchId:x().required("Branch is required"),warrantyDuration:x().nullable().min(0,"Warranty duration cannot be negative").max(120,"Warranty duration cannot exceed 120 months"),minStockLevel:x().min(0,"Minimum stock level cannot be negative")}),Ue=()=>{var q;const{id:c}=H(),u=V(),v=X(),{data:o,isLoading:O,error:U,isError:z,isSuccess:me}=h({queryKey:["product",c],queryFn:()=>ne(Number(c)),enabled:!!c,retry:!1}),{data:b,isLoading:I,error:N}=h({queryKey:["categories"],queryFn:()=>ie({page:1,limit:100})}),{data:y,isLoading:S,error:k}=h({queryKey:["branches"],queryFn:()=>se({page:1,limit:100})}),{data:j,isLoading:C,error:L}=h({queryKey:["departments"],queryFn:()=>de({page:1,limit:100})}),w=oe({mutationFn:a=>re(Number(c),a),onSuccess:()=>{v.invalidateQueries(["product",c]),v.invalidateQueries(["products"]),Q.push(e.jsx(W,{title:"Success",type:"success",children:"Product updated successfully"})),u("/products")},onError:a=>{var s,n;console.error("Update error:",a);let r="Failed to update product";(n=(s=a.response)==null?void 0:s.data)!=null&&n.message?r=a.response.data.message:a.message&&(r=a.message),Q.push(e.jsx(W,{title:"Error",type:"danger",children:r}))}}),_=async(a,{setSubmitting:r})=>{var n;const s={name:a.name.trim(),model:a.model.trim(),categoryId:Number(a.categoryId),branchId:Number(a.branchId),departmentId:a.departmentId?Number(a.departmentId):void 0,warrantyDuration:a.warrantyDuration?Number(a.warrantyDuration):void 0,complianceStatus:!!a.complianceStatus,description:((n=a.description)==null?void 0:n.trim())||void 0,minStockLevel:Number(a.minStockLevel)||0};w.mutate(s),r(!1)},J=()=>{var r,s,n,l;if(!((r=o==null?void 0:o.data)!=null&&r.data))return{name:"",model:"",categoryId:"",branchId:"",departmentId:"",warrantyDuration:"",complianceStatus:!1,description:"",minStockLevel:0};const a=o.data.data;return{name:a.name||"",model:a.model||"",categoryId:((s=a.category)==null?void 0:s.id)||"",branchId:((n=a.branch)==null?void 0:n.id)||"",departmentId:((l=a.department)==null?void 0:l.id)||"",warrantyDuration:a.warrantyDuration||"",complianceStatus:a.complianceStatus||!1,description:a.description||"",minStockLevel:a.minStockLevel||0}};if(O)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(le,{color:"#3B82F6",size:40})});if(z)return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 p-4 bg-red-50 text-red-600 rounded",children:["Error loading product: ",U.message]}),e.jsx(p,{onClick:()=>u(-1),children:"Go Back"})]});if(!((q=o==null?void 0:o.data)!=null&&q.data))return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 text-yellow-600 rounded",children:"Product not found"}),e.jsx(p,{onClick:()=>u(-1),children:"Go Back"})]});const i=o.data.data;return e.jsxs(te,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsxs("h3",{children:["Edit Product: ",i.name]})}),e.jsx(Z,{initialValues:J(),validationSchema:ce,onSubmit:_,enableReinitialize:!0,children:({touched:a,errors:r,isSubmitting:s,values:n,setFieldValue:l})=>{var B,E,P,A,G,K;const D=((B=b==null?void 0:b.data)==null?void 0:B.data)||[],M=((E=y==null?void 0:y.data)==null?void 0:E.data)||[],F=((P=j==null?void 0:j.data)==null?void 0:P.data)||[];return e.jsx(ee,{children:e.jsxs(Y,{children:[e.jsxs($,{className:"mb-6",children:[e.jsx("h4",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{label:"Product Name",invalid:!!r.name&&a.name,errorMessage:r.name,children:e.jsx(m,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:g})}),e.jsx(d,{label:"Model",invalid:!!r.model&&a.model,errorMessage:r.model,children:e.jsx(m,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:g})}),e.jsxs(d,{label:"Category",invalid:!!r.categoryId&&a.categoryId,errorMessage:r.categoryId,children:[e.jsx(f,{placeholder:I?"Loading...":"Select Category",loading:I,options:D.map(t=>({value:t.id,label:t.name})),value:n.categoryId?{value:n.categoryId,label:(A=D.find(t=>t.id===Number(n.categoryId)))==null?void 0:A.name}:null,onChange:t=>l("categoryId",t==null?void 0:t.value)}),N&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",N.message]})]}),e.jsxs(d,{label:"Branch",invalid:!!r.branchId&&a.branchId,errorMessage:r.branchId,children:[e.jsx(f,{placeholder:S?"Loading...":"Select Branch",loading:S,options:M.map(t=>({value:t.id,label:t.name})),value:n.branchId?{value:n.branchId,label:(G=M.find(t=>t.id===Number(n.branchId)))==null?void 0:G.name}:null,onChange:t=>l("branchId",t==null?void 0:t.value)}),k&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",k.message]})]}),e.jsxs(d,{label:"Department (Optional)",children:[e.jsx(f,{placeholder:C?"Loading...":"Select Department",loading:C,options:F.map(t=>({value:t.id,label:t.name})),value:n.departmentId?{value:n.departmentId,label:(K=F.find(t=>t.id===Number(n.departmentId)))==null?void 0:K.name}:null,onChange:t=>l("departmentId",t==null?void 0:t.value),isClearable:!0}),L&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load departments: ",L.message]})]}),e.jsx(d,{label:"Warranty Duration (months)",invalid:!!r.warrantyDuration&&a.warrantyDuration,errorMessage:r.warrantyDuration,children:e.jsx(m,{type:"number",name:"warrantyDuration",placeholder:"e.g., 12, 24, 36",component:g,min:"0",max:"120"})}),e.jsx(d,{label:"Minimum Stock Level",invalid:!!r.minStockLevel&&a.minStockLevel,errorMessage:r.minStockLevel,children:e.jsx(m,{type:"number",name:"minStockLevel",placeholder:"Minimum stock threshold",component:g,min:"0"})}),e.jsx(d,{label:"Compliance Status",children:e.jsx(ae,{name:"complianceStatus",checked:n.complianceStatus,onChange:t=>l("complianceStatus",t),children:"Compliant"})}),e.jsx(d,{label:"Description",children:e.jsx(m,{as:"textarea",name:"description",placeholder:"Additional description",className:"w-full h-20 p-2 border rounded"})})]})]}),i.stockInfo&&e.jsxs($,{className:"mb-6",children:[e.jsx("h4",{className:"mb-4",children:"Current Stock Information"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded",children:[e.jsx("div",{className:"font-semibold text-lg text-blue-600",children:i.stockInfo.totalStock}),e.jsx("div",{className:"text-gray-600",children:"Total Stock"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded",children:[e.jsx("div",{className:"font-semibold text-lg text-green-600",children:i.stockInfo.availableStock}),e.jsx("div",{className:"text-gray-600",children:"Available"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded",children:[e.jsx("div",{className:"font-semibold text-lg text-yellow-600",children:i.stockInfo.assignedStock}),e.jsx("div",{className:"text-gray-600",children:"Assigned"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded",children:[e.jsx("div",{className:"font-semibold text-lg text-red-600",children:i.stockInfo.damagedStock}),e.jsx("div",{className:"text-gray-600",children:"Damaged"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-600",children:i.stockInfo.maintenanceStock}),e.jsx("div",{className:"text-gray-600",children:"Maintenance"})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${i.stockInfo.stockStatus==="AVAILABLE"?"bg-green-100 text-green-800":i.stockInfo.stockStatus==="LOW_STOCK"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:i.stockInfo.stockStatus.replace("_"," ")})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(p,{type:"button",onClick:()=>u(-1),children:"Cancel"}),e.jsx(p,{variant:"solid",type:"submit",loading:s||w.isLoading,children:"Update Product"})]})]})})}},i.id)]})};export{Ue as default};
