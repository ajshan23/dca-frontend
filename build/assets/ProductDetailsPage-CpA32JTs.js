import{M as pe,J as ve,r as h,j as e}from"./index-BUD-ZE7_.js";import{u as je}from"./useQuery-CXHXT3Hp.js";import{u as y}from"./useMutation-Bz2XtFtc.js";import{f as be,j as Ne,k as fe,l as ye,m as we}from"./ProductService-Ri6PTVY1.js";import"./Alert-lH7iap_A.js";import"./index-Ce7Q9rIH.js";import{S as B}from"./index-BnY8lDVe.js";import{B as l}from"./Button-DDszJLvt.js";import{t as o,N as c,D as T}from"./Upload-DwlahUs2.js";import{C as S}from"./Card-CdJ_W77y.js";import"./index-Cf80LcES.js";import"./Drawer-B4NC4z03.js";import"./index-yXOSGI-d.js";import{I as p}from"./hoist-non-react-statics.cjs-DWv9hK0a.js";import"./index-BanB7B1V.js";import"./ScrollBar-Ch0BYWof.js";import{D as U}from"./DataTable-BxgWjzyj.js";import{E as Se,A as z,F as H,x as Ce,G as Ae}from"./index-CGtXMN7D.js";import{M as De,a as ke}from"./index-DfYxwXkZ.js";import{B as W}from"./index-BxQCZkWa.js";import{C as Ee}from"./ClipLoader-BjST-ZuQ.js";import"./toString-BowItcnA.js";import"./proxy-BY76j3GZ.js";import"./Views-DlxN4gyE.js";import"./CloseButton-BxyE3bWT.js";import"./_getPrototype-CEViSscJ.js";import"./index-Chjiymov.js";const Ie={AVAILABLE:"text-green-600 bg-transparent  w-fit",ASSIGNED:"text-blue-600 bg-transparent  w-fit",MAINTENANCE:"text-yellow-600 bg-transparent  w-fit",DAMAGED:"text-red-600 bg-transparent  w-fit",RETIRED:"text-gray-600 bg-transparent  w-fit"},_={NEW:"text-green-600 bg-transparent  w-fit",GOOD:"text-blue-600 bg-transparent  w-fit",FAIR:"text-yellow-600 bg-transparent  w-fit",POOR:"text-orange-600 bg-transparent  w-fit",DAMAGED:"text-red-600 bg-transparent  w-fit"},Re={ASSIGNED:"text-blue-600 bg-transparent   w-fit",RETURNED:"text-emerald-600 bg-transparent   w-fit",OVERDUE:"text-red-600 bg-transparent  w-fit"},lt=()=>{var D,k,E,I,R,P,L,q,O,Q,M;const{id:v}=pe(),V=ve(),[Y,d]=h.useState(!1),[J,j]=h.useState(!1),[i,m]=h.useState(null),[r,w]=h.useState({quantity:1,serialNumbers:[""],purchasePrice:"",location:""}),[g,b]=h.useState(""),{data:x,isLoading:K,error:C,refetch:A}=je({queryKey:["product",v],queryFn:()=>ye(Number(v)),enabled:!!v}),{mutate:Pe,isPending:Le}=y({mutationFn:async t=>{const s=await we(t);if(!(s!=null&&s.qrCode))throw new Error("Invalid QR code data received from server");return s.qrCode},onSuccess:t=>{ne(t)},onError:t=>{o.push(e.jsx(c,{title:"Error",type:"danger",children:t.message||"Failed to generate QR code"}))}}),{mutate:X,isPending:Z}=y({mutationFn:async t=>{var n;const s=await fe(t);if(!((n=s.data)!=null&&n.qrCode))throw new Error("Invalid QR code data received from server");return{qrCode:s.data.qrCode,assignmentInfo:s.data.assignmentInfo}},onSuccess:t=>{ie(t.qrCode,t.assignmentInfo)},onError:t=>{o.push(e.jsx(c,{title:"Error",type:"danger",children:t.message||"Failed to generate assignment QR code"}))}}),{mutate:ee,isPending:te}=y({mutationFn:t=>be(Number(v),t),onSuccess:t=>{var s;o.push(e.jsx(c,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Stock added successfully"})),A(),d(!1),N()},onError:t=>{var s,n;o.push(e.jsx(c,{title:"Error",type:"danger",children:((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to add stock"}))}}),{mutate:se,isPending:ae}=y({mutationFn:t=>Ne(t.inventoryId,t.updateData),onSuccess:t=>{var s;o.push(e.jsx(c,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Inventory updated successfully"})),A(),j(!1),m(null)},onError:t=>{var s,n;o.push(e.jsx(c,{title:"Error",type:"danger",children:((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to update inventory"}))}}),ne=t=>{const s=window.open("","_blank","width=600,height=600");s&&a&&(s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Product QR Code - ${a.name}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .product-info {
                margin-bottom: 20px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>${a.name} QR Code</h2>
            <div class="product-info">
              <p><strong>Model:</strong> ${a.model}</p>
              <p><strong>ID:</strong> ${a.id}</p>
            </div>
            <div class="qr-container">
              <img src="${t}" alt="QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),s.document.close())},ie=(t,s)=>{const n=window.open("","_blank","width=600,height=700");n&&a&&(n.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Assignment QR Code - ${s.productName}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .assignment-info {
                margin-bottom: 20px;
                text-align: left;
              }
              .info-row {
                margin-bottom: 8px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>Assignment QR Code</h2>
            <div class="assignment-info">
              <div class="info-row"><strong>Product:</strong> ${s.productName}</div>
              <div class="info-row"><strong>Assigned To:</strong> ${s.employeeName}</div>
              <div class="info-row"><strong>Assigned On:</strong> ${new Date(s.assignedAt).toLocaleDateString()}</div>
              <div class="info-row"><strong>Status:</strong> ${s.status}</div>
              ${s.expectedReturnAt?`<div class="info-row"><strong>Expected Return:</strong> ${new Date(s.expectedReturnAt).toLocaleDateString()}</div>`:""}
            </div>
            <div class="qr-container">
              <img src="${t}" alt="Assignment QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),n.document.close())},N=()=>{w({quantity:1,serialNumbers:[""],purchasePrice:"",location:""})},re=()=>{const t={quantity:r.quantity,serialNumbers:r.serialNumbers.filter(s=>s.trim()),purchasePrice:r.purchasePrice?Number(r.purchasePrice):void 0,location:r.location.trim()||void 0,reason:"Manual stock addition"};ee(t)},le=t=>{m(t),j(!0)},oe=()=>{i&&se({inventoryId:i.id,updateData:{status:i.status,condition:i.condition,location:i.location,notes:i.notes,serialNumber:i.serialNumber,reason:"Manual inventory update"}})},a=((D=x==null?void 0:x.data)==null?void 0:D.data)||(x==null?void 0:x.data),f=h.useMemo(()=>{if(!(a!=null&&a.inventory)||!g.trim())return(a==null?void 0:a.inventory)||[];const t=g.toLowerCase().trim();return a.inventory.filter(s=>{var F,$,G;const n=((F=s.serialNumber)==null?void 0:F.toLowerCase())||"",u=`item #${s.id}`.toLowerCase(),me=s.status.toLowerCase(),xe=s.condition.toLowerCase(),ue=(($=s.location)==null?void 0:$.toLowerCase())||"",he=((G=s.notes)==null?void 0:G.toLowerCase())||"",ge=s.purchaseDate?new Date(s.purchaseDate).toLocaleDateString().toLowerCase():"";return n.includes(t)||u.includes(t)||me.includes(t)||xe.includes(t)||ue.includes(t)||he.includes(t)||ge.includes(t)})},[a==null?void 0:a.inventory,g]),ce=[{header:"Serial Number",cell:t=>t.row.original.serialNumber||`Item #${t.row.original.id}`},{header:"Status",cell:t=>e.jsx("div",{className:Ie[t.row.original.status]||"",children:t.row.original.status})},{header:"Condition",cell:t=>e.jsx("div",{className:_[t.row.original.condition]||"",children:t.row.original.condition})},{header:"Purchase Date",cell:t=>t.row.original.purchaseDate?new Date(t.row.original.purchaseDate).toLocaleDateString():"-"},{header:"Actions",cell:t=>e.jsx(l,{size:"xs",icon:e.jsx(Ce,{}),onClick:()=>le(t.row.original),disabled:t.row.original.status==="ASSIGNED"})}],de=[{header:"Employee",cell:t=>{var s,n;return e.jsxs("span",{children:[((s=t.row.original.employee)==null?void 0:s.name)||"Unknown",((n=t.row.original.employee)==null?void 0:n.empId)&&` (${t.row.original.employee.empId})`]})}},{header:"Inventory Item",cell:t=>{var s,n;return e.jsx("span",{children:((s=t.row.original.inventory)==null?void 0:s.serialNumber)||`Item #${((n=t.row.original.inventory)==null?void 0:n.id)||"N/A"}`})}},{header:"Assigned On",cell:t=>new Date(t.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:t=>t.row.original.expectedReturnAt?new Date(t.row.original.expectedReturnAt).toLocaleDateString():"-"},{header:"Returned On",cell:t=>t.row.original.returnedAt?new Date(t.row.original.returnedAt).toLocaleDateString():"-"},{header:"Status",cell:t=>e.jsx("div",{className:Re[t.row.original.status]||"",children:t.row.original.status})},{header:"Return Condition",cell:t=>t.row.original.returnCondition?e.jsx("div",{className:_[t.row.original.returnCondition]||"",children:t.row.original.returnCondition}):e.jsx("span",{children:"-"})},{header:"Assigned By",cell:t=>{var s;return((s=t.row.original.assignedBy)==null?void 0:s.username)||"Unknown"}},{header:"Actions",cell:t=>e.jsx(l,{size:"xs",icon:e.jsx(Ae,{}),onClick:()=>X(t.row.original.id),loading:Z,title:"Generate QR Code"})}];return C&&o.push(e.jsx(c,{title:"Error",type:"danger",children:C.message||"Failed to load product details"})),K?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ee,{color:"#3B82F6",size:40})}):a?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(l,{variant:"plain",icon:e.jsx(Se,{}),onClick:()=>V(-1),children:"Back to Products"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(l,{variant:"twoTone",icon:e.jsx(z,{}),onClick:()=>d(!0),children:"Add Stock"})})]}),e.jsx(S,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.model}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Category:"}),e.jsx("span",{className:"ml-2",children:((k=a.category)==null?void 0:k.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Branch:"}),e.jsx("span",{className:"ml-2",children:((E=a.branch)==null?void 0:E.name)||"-"})]}),a.department&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Department:"}),e.jsx("span",{className:"ml-2",children:a.department.name})]}),a.warrantyDuration&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Warranty Duration:"}),e.jsxs("span",{className:"ml-2",children:[a.warrantyDuration," months"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Minimum Stock Level:"}),e.jsx("span",{className:"ml-2",children:a.minStockLevel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(a.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx("div",{className:a.complianceStatus?"font-bold text-green-500":"font-bold text-red-500",children:a.complianceStatus?"Compliant":"Non-compliant"})}),e.jsxs("div",{className:" p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Stock Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Stock:"}),e.jsx("span",{className:"ml-2 font-semibold",children:((I=a.stockStats)==null?void 0:I.totalStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Available:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-600",children:((R=a.stockStats)==null?void 0:R.availableStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assigned:"}),e.jsx("span",{className:"ml-2 font-semibold text-blue-600",children:((P=a.stockStats)==null?void 0:P.assignedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Damaged:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-600",children:((L=a.stockStats)==null?void 0:L.damagedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Maintenance:"}),e.jsx("span",{className:"ml-2 font-semibold text-yellow-600",children:((q=a.stockStats)==null?void 0:q.maintenanceStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Retired:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-600",children:((O=a.stockStats)==null?void 0:O.retiredStock)||0})]})]})]}),e.jsxs("div",{className:" p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:a.description||"No description available"})]})]})]})}),e.jsxs(S,{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Inventory Items"})]})}),e.jsx("div",{className:"mb-4 max-w-md",children:e.jsx(p,{placeholder:"Search inventory items...",value:g,onChange:t=>b(t.target.value),prefix:e.jsx(H,{className:"text-gray-400"}),clearButton:!0,onClear:()=>b("")})}),g.trim()&&e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Showing ",f.length," of ",((Q=a.inventory)==null?void 0:Q.length)||0," items",f.length!==(((M=a.inventory)==null?void 0:M.length)||0)&&e.jsx(l,{variant:"plain",size:"xs",className:"ml-2",onClick:()=>b(""),children:"Clear search"})]}),!a.inventory||a.inventory.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items found for this product"}),e.jsx(l,{className:"mt-4",variant:"solid",icon:e.jsx(z,{}),onClick:()=>d(!0),children:"Add First Stock"})]}):f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items match your search"}),e.jsx(l,{className:"mt-4",variant:"plain",onClick:()=>b(""),children:"Clear search"})]}):e.jsx(U,{columns:ce,data:f})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Assignment History"})]}),!a.assignments||a.assignments.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No assignments found for this product"})}):e.jsx(U,{columns:de,data:a.assignments})]}),e.jsx(T,{isOpen:Y,onClose:()=>{d(!1),N()},onRequestClose:()=>{d(!1),N()},width:500,children:e.jsxs("div",{className:"max-h-[80vh] flex flex-col",children:[e.jsx("h4",{className:"mb-4 flex-shrink-0",children:"Add Stock"}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity"}),e.jsx(p,{type:"number",min:"1",max:"100",value:r.quantity,onChange:t=>{const s=Number(t.target.value);w({...r,quantity:s,serialNumbers:Array.from({length:s},(n,u)=>r.serialNumbers[u]||"")})}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Serial Numbers (Optional - ",r.serialNumbers.filter(t=>t.trim()).length," of ",r.quantity," filled)"]}),r.quantity>10&&e.jsx("div",{className:"border border-yellow-200 rounded p-2 mb-2",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"Large quantity detected. Consider using batch serial number format or leave empty for auto-generation."})}),e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded p-3 ",style:{scrollbarWidth:"thin",scrollbarColor:"#cbd5e1 #f1f5f9"},children:e.jsx("div",{className:"space-y-2",children:Array.from({length:r.quantity},(t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-8 flex-shrink-0",children:["#",s+1]}),e.jsx(p,{type:"text",placeholder:`Serial number ${s+1}`,value:r.serialNumbers[s]||"",onChange:n=>{const u=[...r.serialNumbers];u[s]=n.target.value,w({...r,serialNumbers:u})},className:"flex-1",size:"sm"})]},s))})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Leave empty for non-serialized items. Scroll within the box above for many items."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6 pt-4 border-t flex-shrink-0",children:[e.jsx(l,{variant:"plain",onClick:()=>{d(!1),N()},children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:re,loading:te,icon:e.jsx(W,{}),children:"Add Stock"})]})]})}),e.jsxs(T,{isOpen:J,onClose:()=>j(!1),width:400,children:[e.jsx("h4",{className:"mb-4",children:"Edit Inventory Item"}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Serial Number"}),e.jsx(p,{type:"text",value:i.serialNumber||"",onChange:t=>m({...i,serialNumber:t.target.value||null}),placeholder:"Enter serial number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsx(B,{value:{value:i.status,label:i.status},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Maintenance"},{value:"DAMAGED",label:"Damaged"},{value:"RETIRED",label:"Retired"}],onChange:t=>m({...i,status:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx(B,{value:{value:i.condition,label:i.condition},options:[{value:"NEW",label:"New"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"},{value:"DAMAGED",label:"Damaged"}],onChange:t=>m({...i,condition:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx(p,{as:"textarea",value:i.notes||"",onChange:t=>m({...i,notes:t.target.value}),placeholder:"Additional notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(l,{variant:"plain",onClick:()=>j(!1),children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:oe,loading:ae,children:"Update"})]})]})]})]}):e.jsx("div",{className:"p-4 text-center",children:"Product not found"})};export{lt as default};
