import{M as se,J as ae,r as j,j as e}from"./index-DOAI5wD-.js";import{u as ie}from"./useQuery-DE2si_Nz.js";import{u as v}from"./useMutation-COMEHNJA.js";import{j as ne,f as re,k as le,l as oe}from"./ProductService-C-reRKyq.js";import"./Alert--60sw6Eb.js";import"./index-DWx7u_gE.js";import{C as N,B as x}from"./Card-B7s_QonD.js";import{B as l}from"./Button-XDzj27iK.js";import{t as c,N as d,D as O}from"./Upload-BcjT7ecx.js";import"./index-B5w90T9J.js";import"./Drawer-rypE1f-W.js";import"./index-CcD7OED0.js";import{I as b}from"./hoist-non-react-statics.cjs-B_CdNjYy.js";import"./index-BymdkX6d.js";import{S as M}from"./index-c39d8Au7.js";import"./ScrollBar-9QFGDQMi.js";import{D as F}from"./DataTable-DjDyXVg4.js";import{D as ce,z as B,E as de,w as me}from"./index-Bs40O9gV.js";import{M as he,a as ue}from"./index-B4tj3JjS.js";import{B as L}from"./index-07rNRI90.js";import{C as xe}from"./ClipLoader-C6OYDx6I.js";import"./toString-DOk9WYfW.js";import"./proxy-BSpLPB4F.js";import"./Views-DsXxJgF6.js";import"./CloseButton-Ck51-gyX.js";import"./_getPrototype-BB3-PSDv.js";import"./index-Chjiymov.js";const ge={AVAILABLE:"bg-green-500 text-white w-fit",ASSIGNED:"bg-blue-500 text-white w-fit",MAINTENANCE:"bg-yellow-500 text-white w-fit",DAMAGED:"bg-red-500 text-white w-fit",RETIRED:"bg-gray-500 text-white w-fit"},q={NEW:"bg-green-500 text-white w-fit",GOOD:"bg-blue-500 text-white w-fit",FAIR:"bg-yellow-500 text-white w-fit",POOR:"bg-orange-500 text-white w-fit",DAMAGED:"bg-red-500 text-white w-fit"},pe={ASSIGNED:"bg-blue-500 text-white w-fit",RETURNED:"bg-emerald-500 text-white w-fit",OVERDUE:"bg-red-500 text-white w-fit"},He=()=>{var w,S,k,D,A,C,E,I,P;const{id:m}=se(),G=ae(),[Q,h]=j.useState(!1),[T,g]=j.useState(!1),[i,u]=j.useState(null),[n,p]=j.useState({quantity:1,serialNumbers:[""],purchasePrice:"",location:""}),{data:o,isLoading:$,error:y,refetch:f}=ie({queryKey:["product",m],queryFn:()=>oe(Number(m)),enabled:!!m}),{mutate:U,isPending:H}=v({mutationFn:async t=>{const s=await ne(t);if(!(s!=null&&s.qrCode))throw new Error("Invalid QR code data received from server");return s.qrCode},onSuccess:t=>{J(t)},onError:t=>{c.push(e.jsx(d,{title:"Error",type:"danger",children:t.message||"Failed to generate QR code"}))}}),{mutate:W,isPending:z}=v({mutationFn:t=>re(Number(m),t),onSuccess:t=>{var s;c.push(e.jsx(d,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Stock added successfully"})),f(),h(!1),K()},onError:t=>{var s,r;c.push(e.jsx(d,{title:"Error",type:"danger",children:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to add stock"}))}}),{mutate:V,isPending:_}=v({mutationFn:t=>le(t.inventoryId,t.updateData),onSuccess:t=>{var s;c.push(e.jsx(d,{title:"Success",type:"success",children:((s=t.data)==null?void 0:s.message)||"Inventory updated successfully"})),f(),g(!1),u(null)},onError:t=>{var s,r;c.push(e.jsx(d,{title:"Error",type:"danger",children:((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update inventory"}))}}),J=t=>{const s=window.open("","_blank","width=600,height=600");s&&a&&(s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Product QR Code - ${a.name}</title>
            <style>
              body { 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              }
              .qr-container {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              .product-info {
                margin-bottom: 20px;
              }
              img { width: 100%; height: auto; }
            </style>
          </head>
          <body>
            <h2>${a.name} QR Code</h2>
            <div class="product-info">
              <p><strong>Model:</strong> ${a.model}</p>
              <p><strong>ID:</strong> ${a.id}</p>
            </div>
            <div class="qr-container">
              <img src="${t}" alt="QR Code" />
            </div>
            <script>
              setTimeout(() => { window.print(); window.close(); }, 300);
            <\/script>
          </body>
        </html>
      `),s.document.close())},K=()=>{p({quantity:1,serialNumbers:[""],purchasePrice:"",location:""})},Y=()=>{const t={quantity:n.quantity,serialNumbers:n.serialNumbers.filter(s=>s.trim()),purchasePrice:n.purchasePrice?Number(n.purchasePrice):void 0,location:n.location.trim()||void 0,reason:"Manual stock addition"};W(t)},X=t=>{u(t),g(!0)},Z=()=>{i&&V({inventoryId:i.id,updateData:{status:i.status,condition:i.condition,location:i.location,notes:i.notes,reason:"Manual inventory update"}})},a=((w=o==null?void 0:o.data)==null?void 0:w.data)||(o==null?void 0:o.data),ee=[{header:"Serial Number",cell:t=>t.row.original.serialNumber||`Item #${t.row.original.id}`},{header:"Status",cell:t=>e.jsx(x,{className:ge[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Condition",cell:t=>e.jsx(x,{className:q[t.row.original.condition]||"bg-gray-500 text-white",children:t.row.original.condition})},{header:"Purchase Date",cell:t=>t.row.original.purchaseDate?new Date(t.row.original.purchaseDate).toLocaleDateString():"-"},{header:"Actions",cell:t=>e.jsx(l,{size:"xs",icon:e.jsx(me,{}),onClick:()=>X(t.row.original),disabled:t.row.original.status==="ASSIGNED"})}],te=[{header:"Employee",cell:t=>{var s,r;return e.jsxs("span",{children:[((s=t.row.original.employee)==null?void 0:s.name)||"Unknown",((r=t.row.original.employee)==null?void 0:r.empId)&&` (${t.row.original.employee.empId})`]})}},{header:"Inventory Item",cell:t=>{var s,r;return e.jsx("span",{children:((s=t.row.original.inventory)==null?void 0:s.serialNumber)||`Item #${((r=t.row.original.inventory)==null?void 0:r.id)||"N/A"}`})}},{header:"Assigned On",cell:t=>new Date(t.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:t=>t.row.original.expectedReturnAt?new Date(t.row.original.expectedReturnAt).toLocaleDateString():"-"},{header:"Returned On",cell:t=>t.row.original.returnedAt?new Date(t.row.original.returnedAt).toLocaleDateString():"-"},{header:"Status",cell:t=>e.jsx(x,{className:pe[t.row.original.status]||"bg-gray-500",children:t.row.original.status})},{header:"Return Condition",cell:t=>t.row.original.returnCondition?e.jsx(x,{className:q[t.row.original.returnCondition]||"bg-gray-500 text-white",children:t.row.original.returnCondition}):e.jsx("span",{children:"-"})},{header:"Assigned By",cell:t=>{var s;return((s=t.row.original.assignedBy)==null?void 0:s.username)||"Unknown"}}];return y&&c.push(e.jsx(d,{title:"Error",type:"danger",children:y.message||"Failed to load product details"})),$?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(xe,{color:"#3B82F6",size:40})}):a?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(l,{variant:"plain",icon:e.jsx(ce,{}),onClick:()=>G(-1),children:"Back to Products"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"twoTone",icon:e.jsx(B,{}),onClick:()=>h(!0),children:"Add Stock"}),e.jsx(l,{variant:"solid",icon:e.jsx(de,{}),loading:H,onClick:()=>U(Number(m)),children:"Generate & Print QR"})]})]}),e.jsx(N,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.model}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Category:"}),e.jsx("span",{className:"ml-2",children:((S=a.category)==null?void 0:S.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Branch:"}),e.jsx("span",{className:"ml-2",children:((k=a.branch)==null?void 0:k.name)||"-"})]}),a.department&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Department:"}),e.jsx("span",{className:"ml-2",children:a.department.name})]}),a.warrantyDuration&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Warranty Duration:"}),e.jsxs("span",{className:"ml-2",children:[a.warrantyDuration," months"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Minimum Stock Level:"}),e.jsx("span",{className:"ml-2",children:a.minStockLevel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(a.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx(x,{className:a.complianceStatus?"text-white bg-green-500":"text-white bg-red-500",children:a.complianceStatus?"Compliant":"Non-compliant"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Stock Overview"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Stock:"}),e.jsx("span",{className:"ml-2 font-semibold",children:((D=a.stockStats)==null?void 0:D.totalStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Available:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-600",children:((A=a.stockStats)==null?void 0:A.availableStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assigned:"}),e.jsx("span",{className:"ml-2 font-semibold text-blue-600",children:((C=a.stockStats)==null?void 0:C.assignedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Damaged:"}),e.jsx("span",{className:"ml-2 font-semibold text-red-600",children:((E=a.stockStats)==null?void 0:E.damagedStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Maintenance:"}),e.jsx("span",{className:"ml-2 font-semibold text-yellow-600",children:((I=a.stockStats)==null?void 0:I.maintenanceStock)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Retired:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-600",children:((P=a.stockStats)==null?void 0:P.retiredStock)||0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:a.description||"No description available"})]})]})]})}),e.jsxs(N,{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Inventory Items"})]})}),!a.inventory||a.inventory.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No inventory items found for this product"}),e.jsx(l,{className:"mt-4",variant:"solid",icon:e.jsx(B,{}),onClick:()=>h(!0),children:"Add First Stock"})]}):e.jsx(F,{columns:ee,data:a.inventory})]}),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{}),e.jsx("h3",{className:"text-xl font-semibold",children:"Assignment History"})]}),!a.assignments||a.assignments.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No assignments found for this product"})}):e.jsx(F,{columns:te,data:a.assignments})]}),e.jsxs(O,{isOpen:Q,onClose:()=>h(!1),width:500,children:[e.jsxs("h4",{className:"mb-4",children:["Add Stock to ",a.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity"}),e.jsx(b,{type:"number",min:"1",max:"100",value:n.quantity,onChange:t=>p({...n,quantity:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Purchase Price per Item (Optional)"}),e.jsx(b,{type:"number",min:"0",step:"0.01",value:n.purchasePrice,onChange:t=>p({...n,purchasePrice:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Serial Numbers (Optional - ",n.serialNumbers.length," of ",n.quantity,")"]}),Array.from({length:n.quantity},(t,s)=>e.jsx(b,{type:"text",placeholder:`Serial number ${s+1}`,value:n.serialNumbers[s]||"",onChange:r=>{const R=[...n.serialNumbers];R[s]=r.target.value,p({...n,serialNumbers:R})},className:"mb-2"},s))]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(l,{variant:"plain",onClick:()=>h(!1),children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:Y,loading:z,icon:e.jsx(L,{}),children:"Add Stock"})]})]})]}),e.jsxs(O,{isOpen:T,onClose:()=>g(!1),width:400,children:[e.jsx("h4",{className:"mb-4",children:"Edit Inventory Item"}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsx(M,{value:{value:i.status,label:i.status},options:[{value:"AVAILABLE",label:"Available"},{value:"MAINTENANCE",label:"Maintenance"},{value:"DAMAGED",label:"Damaged"},{value:"RETIRED",label:"Retired"}],onChange:t=>u({...i,status:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx(M,{value:{value:i.condition,label:i.condition},options:[{value:"NEW",label:"New"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"},{value:"DAMAGED",label:"Damaged"}],onChange:t=>u({...i,condition:t.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx(b,{as:"textarea",value:i.notes||"",onChange:t=>u({...i,notes:t.target.value}),placeholder:"Additional notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(l,{variant:"plain",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:Z,loading:_,children:"Update"})]})]})]})]}):e.jsx("div",{className:"p-4 text-center",children:"Product not found"})};export{He as default};
