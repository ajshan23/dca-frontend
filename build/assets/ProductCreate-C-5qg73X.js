import{J as Q,r as A,j as e}from"./index-xBb4Cu5p.js";import{F as T,a as s}from"./Alert-eifFNp7B.js";import{B as j}from"./Button-DpFfS7qi.js";import{F as z,c as J,a as R,b as c,e as U,f as X,g,d as k}from"./index.esm-BSephAUd.js";import"./index-DUchRYx7.js";import{S as C}from"./index-CCxRe_lL.js";import{t as G,N as K}from"./Upload-Br0nJyki.js";import{C as O}from"./Card-DUFOzyf7.js";import{C as Y}from"./index-B9jXH76y.js";import"./index-DPKcPQiU.js";import{I as d}from"./hoist-non-react-statics.cjs-D9D9Op99.js";import"./index-LBerdN8z.js";import"./ScrollBar--d9coRPU.js";import{A as Z}from"./AdaptableCard-C8NAqNcm.js";import"./Views--okuRfCK.js";import"./chart.config-TIV3arlo.js";import{F as _}from"./index-CeosE6Mu.js";import"./DataTable-DPSpAcGJ.js";import"./SvgIcon-Bg4gHeyf.js";import{j as V}from"./ProductService-CjGHow6K.js";import{u as w}from"./useQuery-C5ra9VKq.js";import{a as ee}from"./CategoryService-C_OzfvId.js";import{a as ae}from"./BranchService-fe6aG-r_.js";import{a as re}from"./DepartmentService-BKfxgzHq.js";import"./toString-CfufOl4R.js";import"./CloseButton-B3Yr_F5T.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-RCTy2yb6.js";import"./index-Chjiymov.js";import"./useThemeClass-CVZ0ENSo.js";const te=J().shape({name:k().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:k().required("Model is required"),categoryId:g().required("Category is required"),branchId:g().required("Branch is required"),warrantyDuration:g().nullable().min(0,"Warranty duration cannot be negative").max(120,"Warranty duration cannot exceed 120 months"),minStockLevel:g().min(0,"Minimum stock level cannot be negative"),initialStock:g().min(0,"Initial stock cannot be negative").max(1e3,"Initial stock cannot exceed 1000"),serialNumbers:X().of(k().trim())}),Be=()=>{const v=Q(),[f,W]=A.useState(!1),{data:N,isLoading:L,error:M}=w({queryKey:["categories"],queryFn:()=>ee({page:1,limit:100})}),{data:S,isLoading:D,error:q}=w({queryKey:["branches"],queryFn:()=>ae({page:1,limit:100})}),{data:I,isLoading:F,error:ie}=w({queryKey:["departments"],queryFn:()=>re({page:1,limit:100})}),H=async(t,{setSubmitting:i})=>{var x,r,n,h,u,b;i(!0);try{const o={name:t.name.trim(),model:t.model.trim(),categoryId:Number(t.categoryId),branchId:Number(t.branchId),departmentId:t.departmentId?Number(t.departmentId):void 0,warrantyDuration:t.warrantyDuration?Number(t.warrantyDuration):void 0,complianceStatus:!!t.complianceStatus,description:((x=t.description)==null?void 0:x.trim())||void 0,minStockLevel:Number(t.minStockLevel)||0,initialStock:Number(t.initialStock)||0,serialNumbers:((r=t.serialNumbers)==null?void 0:r.filter(y=>y.trim()))||[],purchaseDate:t.purchaseDate||void 0,location:((n=t.location)==null?void 0:n.trim())||void 0},l=await V(o);if(l.status===201)G.push(e.jsx(K,{title:"Success",type:"success",children:((h=l.data)==null?void 0:h.message)||"Product created successfully"})),v("/products");else throw new Error(l.message||"Failed to create product")}catch(o){console.error("Product creation error:",o);let l="Failed to create product";(b=(u=o.response)==null?void 0:u.data)!=null&&b.message?l=o.response.data.message:o.message&&(l=o.message),G.push(e.jsx(K,{title:"Error",type:"danger",children:l}))}finally{i(!1)}};return e.jsxs(Z,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("h3",{children:"Create New Product"})}),e.jsx(z,{initialValues:{name:"",model:"",categoryId:"",branchId:"",departmentId:"",warrantyDuration:"",complianceStatus:!1,description:"",minStockLevel:null,initialStock:null,serialNumbers:[""],purchaseDate:"",location:""},validationSchema:te,onSubmit:H,children:({touched:t,errors:i,isSubmitting:x,values:r,setFieldValue:n})=>{var o,l,y,P,E,B;const h=((o=N==null?void 0:N.data)==null?void 0:o.data)||[],u=((l=S==null?void 0:S.data)==null?void 0:l.data)||[],b=((y=I==null?void 0:I.data)==null?void 0:y.data)||[];return A.useEffect(()=>{const a=r.serialNumbers.length,p=Math.max(1,Number(r.initialStock)||0);if(p!==a){if(p>a){const m=[...r.serialNumbers];for(;m.length<p;)m.push("");n("serialNumbers",m)}else if(p<a){const m=r.serialNumbers.slice(0,Math.max(1,p));n("serialNumbers",m)}}},[r.initialStock,r.serialNumbers.length,n]),e.jsx(R,{children:e.jsxs(T,{children:[e.jsxs(O,{className:"mb-6",children:[e.jsx("h4",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{label:"Product Name",invalid:!!i.name&&t.name,errorMessage:i.name,children:e.jsx(c,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:d})}),e.jsx(s,{label:"Model",invalid:!!i.model&&t.model,errorMessage:i.model,children:e.jsx(c,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:d})}),e.jsxs(s,{label:"Category",invalid:!!i.categoryId&&t.categoryId,errorMessage:i.categoryId,children:[e.jsx(C,{placeholder:L?"Loading...":"Select Category",loading:L,options:h.map(a=>({value:a.id,label:a.name})),value:r.categoryId?{value:r.categoryId,label:(P=h.find(a=>a.id===r.categoryId))==null?void 0:P.name}:null,onChange:a=>n("categoryId",a==null?void 0:a.value)}),M&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",M.message]})]}),e.jsxs(s,{label:"Branch",invalid:!!i.branchId&&t.branchId,errorMessage:i.branchId,children:[e.jsx(C,{placeholder:D?"Loading...":"Select Branch",loading:D,options:u.map(a=>({value:a.id,label:a.name})),value:r.branchId?{value:r.branchId,label:(E=u.find(a=>a.id===r.branchId))==null?void 0:E.name}:null,onChange:a=>n("branchId",a==null?void 0:a.value)}),q&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",q.message]})]}),e.jsx(s,{label:"Department (Optional)",children:e.jsx(C,{placeholder:F?"Loading...":"Select Department",loading:F,options:b.map(a=>({value:a.id,label:a.name})),value:r.departmentId?{value:r.departmentId,label:(B=b.find(a=>a.id===r.departmentId))==null?void 0:B.name}:null,onChange:a=>n("departmentId",a==null?void 0:a.value),isClearable:!0})}),e.jsx(s,{label:"Warranty Duration (months)",invalid:!!i.warrantyDuration&&t.warrantyDuration,errorMessage:i.warrantyDuration,children:e.jsx(c,{type:"number",name:"warrantyDuration",placeholder:"e.g., 12, 24, 36",component:d,min:"0",max:"120"})}),e.jsx(s,{label:"Minimum Stock Level",invalid:!!i.minStockLevel&&t.minStockLevel,errorMessage:i.minStockLevel,children:e.jsx(c,{type:"number",name:"minStockLevel",placeholder:"Minimum stock threshold",component:d,min:"0"})}),e.jsx(s,{label:"Compliance Status",children:e.jsx(Y,{name:"complianceStatus",checked:r.complianceStatus,onChange:a=>n("complianceStatus",a),children:"Compliant"})}),e.jsx(s,{label:"Description",children:e.jsx(c,{as:"textarea",name:"description",placeholder:"Additional description",className:"w-full h-20 p-2 border rounded"})})]})]}),e.jsxs(O,{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{children:"Initial Stock (Optional)"}),e.jsxs(j,{type:"button",variant:"plain",onClick:()=>W(!f),children:[f?"Hide":"Add"," Initial Stock"]})]}),f&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{label:"Initial Stock Quantity",invalid:!!i.initialStock&&t.initialStock,errorMessage:i.initialStock,children:e.jsx(c,{type:"number",name:"initialStock",placeholder:"Number of items",component:d,min:"0",max:"1000"})}),e.jsx(s,{label:"Purchase Date",children:e.jsx(c,{type:"date",name:"purchaseDate",component:d})}),Number(r.initialStock)>0&&e.jsx("div",{className:"md:col-span-2",children:e.jsx(s,{label:`Serial Numbers (${r.serialNumbers.length} items)`,children:e.jsx(U,{name:"serialNumbers",children:({remove:a})=>e.jsxs("div",{className:"space-y-2",children:[r.serialNumbers.map((p,m)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"text",name:`serialNumbers.${m}`,placeholder:`Serial number for item ${m+1}`,component:d,className:"flex-1"}),r.serialNumbers.length>1&&e.jsx(j,{type:"button",size:"sm",variant:"plain",icon:e.jsx(_,{}),onClick:()=>{const $=[...r.serialNumbers];$.splice(m,1),n("serialNumbers",$),n("initialStock",Math.max(0,Number(r.initialStock)-1))}})]},m)),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter serial numbers for each item. Serial numbers are required for trackable items."})]})})})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{type:"button",onClick:()=>v(-1),children:"Cancel"}),e.jsx(j,{variant:"solid",type:"submit",loading:x,children:"Create Product"})]})]})})}})]})};export{Be as default};
